"use strict";(globalThis.webpackChunkyiwen_blog_website=globalThis.webpackChunkyiwen_blog_website||[]).push([[98081],{28453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>c});var l=n(96540);const a={},i=l.createContext(a);function r(e){const s=l.useContext(i);return l.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),l.createElement(i.Provider,{value:s},e.children)}},37140:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>t,contentTitle:()=>c,default:()=>o,frontMatter:()=>r,metadata:()=>l,toc:()=>d});const l=JSON.parse('{"id":"backend/k8s/rolling-update-hpa","title":"Kubernetes \u70ed\u66f4\u65b0\u4e0e\u81ea\u52a8\u6269\u7f29\u5bb9 (HPA)","description":"\u8fd9\u4e24\u9879\u529f\u80fd\u662f K8s \u533a\u522b\u4e8e\u4f20\u7edf\u8fd0\u7ef4\u6a21\u5f0f\u7684\u6838\u5fc3\u7ade\u4e89\u529b\uff0c\u4e5f\u662f\u4fdd\u969c\u670d\u52a1\\"\u9ad8\u53ef\u7528\\"\u548c\\"\u9ad8\u5f39\u6027\\"\u7684\u57fa\u77f3\u3002","source":"@site/docs/backend/k8s/rolling-update-hpa.md","sourceDirName":"backend/k8s","slug":"/backend/k8s/rolling-update-hpa","permalink":"/yiwen-blog-website/en/docs/backend/k8s/rolling-update-hpa","draft":false,"unlisted":false,"editUrl":"https://github.com/Hao-yiwen/yiwen-blog-website/tree/master/docs/backend/k8s/rolling-update-hpa.md","tags":[{"inline":true,"label":"kubernetes","permalink":"/yiwen-blog-website/en/docs/tags/kubernetes"},{"inline":true,"label":"k8s","permalink":"/yiwen-blog-website/en/docs/tags/k-8-s"},{"inline":true,"label":"rolling-update","permalink":"/yiwen-blog-website/en/docs/tags/rolling-update"},{"inline":true,"label":"hpa","permalink":"/yiwen-blog-website/en/docs/tags/hpa"},{"inline":true,"label":"autoscaling","permalink":"/yiwen-blog-website/en/docs/tags/autoscaling"},{"inline":true,"label":"devops","permalink":"/yiwen-blog-website/en/docs/tags/devops"}],"version":"current","lastUpdatedAt":1768228036000,"sidebarPosition":3,"frontMatter":{"title":"Kubernetes \u70ed\u66f4\u65b0\u4e0e\u81ea\u52a8\u6269\u7f29\u5bb9 (HPA)","sidebar_position":3,"tags":["kubernetes","k8s","rolling-update","hpa","autoscaling","devops"]},"sidebar":"backendSidebar","previous":{"title":"\u4f7f\u7528 ConfigMap \u5b58\u50a8 HTML \u9875\u9762","permalink":"/yiwen-blog-website/en/docs/backend/k8s/configmap-html"},"next":{"title":"DevOps","permalink":"/yiwen-blog-website/en/docs/category/devops"}}');var a=n(74848),i=n(28453);const r={title:"Kubernetes \u70ed\u66f4\u65b0\u4e0e\u81ea\u52a8\u6269\u7f29\u5bb9 (HPA)",sidebar_position:3,tags:["kubernetes","k8s","rolling-update","hpa","autoscaling","devops"]},c="Kubernetes \u6838\u5fc3\u673a\u5236\u8be6\u89e3\uff1a\u70ed\u66f4\u65b0\u4e0e\u81ea\u52a8\u6269\u7f29\u5bb9",t={},d=[{value:"1. \u70ed\u66f4\u65b0 (Rolling Update)",id:"1-\u70ed\u66f4\u65b0-rolling-update",level:2},{value:"1.1 \u4ec0\u4e48\u662f\u70ed\u66f4\u65b0\uff1f",id:"11-\u4ec0\u4e48\u662f\u70ed\u66f4\u65b0",level:3},{value:"1.2 \u6838\u5fc3\u539f\u7406\uff1aReplicaSet \u7684\u4ea4\u63a5\u68d2",id:"12-\u6838\u5fc3\u539f\u7406replicaset-\u7684\u4ea4\u63a5\u68d2",level:3},{value:"1.3 \u5173\u952e\u914d\u7f6e\u53c2\u6570",id:"13-\u5173\u952e\u914d\u7f6e\u53c2\u6570",level:3},{value:"1.4 \u5fc5\u4e0d\u53ef\u5c11\u7684\u673a\u5236\uff1aReadiness Probe (\u5c31\u7eea\u63a2\u9488)",id:"14-\u5fc5\u4e0d\u53ef\u5c11\u7684\u673a\u5236readiness-probe-\u5c31\u7eea\u63a2\u9488",level:3},{value:"1.5 \u5e38\u7528\u547d\u4ee4",id:"15-\u5e38\u7528\u547d\u4ee4",level:3},{value:"2. \u81ea\u52a8\u6269\u7f29\u5bb9 (HPA - Horizontal Pod Autoscaler)",id:"2-\u81ea\u52a8\u6269\u7f29\u5bb9-hpa---horizontal-pod-autoscaler",level:2},{value:"2.1 \u4ec0\u4e48\u662f HPA\uff1f",id:"21-\u4ec0\u4e48\u662f-hpa",level:3},{value:"2.2 \u5de5\u4f5c\u6d41\u7a0b (The Control Loop)",id:"22-\u5de5\u4f5c\u6d41\u7a0b-the-control-loop",level:3},{value:"2.3 \u6838\u5fc3\u7b97\u6cd5",id:"23-\u6838\u5fc3\u7b97\u6cd5",level:3},{value:"2.4 \u5b9e\u65bd HPA \u7684\u786c\u6027\u524d\u63d0",id:"24-\u5b9e\u65bd-hpa-\u7684\u786c\u6027\u524d\u63d0",level:3},{value:"2.5 \u6269\u7f29\u5bb9\u7684&quot;\u9632\u6296\u52a8&quot;\u673a\u5236",id:"25-\u6269\u7f29\u5bb9\u7684\u9632\u6296\u52a8\u673a\u5236",level:3},{value:"3. \u4e24\u8005\u5982\u4f55\u914d\u5408\u5de5\u4f5c\uff1f",id:"3-\u4e24\u8005\u5982\u4f55\u914d\u5408\u5de5\u4f5c",level:2},{value:"\u6700\u4f73\u5b9e\u8df5\u603b\u7ed3",id:"\u6700\u4f73\u5b9e\u8df5\u603b\u7ed3",level:2}];function h(e){const s={annotation:"annotation",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",math:"math",mfrac:"mfrac",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",mtext:"mtext",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"kubernetes-\u6838\u5fc3\u673a\u5236\u8be6\u89e3\u70ed\u66f4\u65b0\u4e0e\u81ea\u52a8\u6269\u7f29\u5bb9",children:"Kubernetes \u6838\u5fc3\u673a\u5236\u8be6\u89e3\uff1a\u70ed\u66f4\u65b0\u4e0e\u81ea\u52a8\u6269\u7f29\u5bb9"})}),"\n",(0,a.jsx)(s.p,{children:'\u8fd9\u4e24\u9879\u529f\u80fd\u662f K8s \u533a\u522b\u4e8e\u4f20\u7edf\u8fd0\u7ef4\u6a21\u5f0f\u7684\u6838\u5fc3\u7ade\u4e89\u529b\uff0c\u4e5f\u662f\u4fdd\u969c\u670d\u52a1"\u9ad8\u53ef\u7528"\u548c"\u9ad8\u5f39\u6027"\u7684\u57fa\u77f3\u3002'}),"\n",(0,a.jsx)(s.h2,{id:"1-\u70ed\u66f4\u65b0-rolling-update",children:"1. \u70ed\u66f4\u65b0 (Rolling Update)"}),"\n",(0,a.jsx)(s.h3,{id:"11-\u4ec0\u4e48\u662f\u70ed\u66f4\u65b0",children:"1.1 \u4ec0\u4e48\u662f\u70ed\u66f4\u65b0\uff1f"}),"\n",(0,a.jsxs)(s.p,{children:["\u70ed\u66f4\u65b0\uff08Rolling Update\uff09\u662f Kubernetes ",(0,a.jsx)(s.code,{children:"Deployment"})," \u9ed8\u8ba4\u7684\u53d1\u5e03\u7b56\u7565\u3002\u5b83\u7684\u76ee\u6807\u662f\u5728",(0,a.jsx)(s.strong,{children:"\u4e0d\u4e2d\u65ad\u670d\u52a1"}),"\u7684\u60c5\u51b5\u4e0b\uff0c\u5c06\u5e94\u7528\u4ece\u65e7\u7248\u672c\uff08v1\uff09\u5e73\u6ed1\u8fc7\u6e21\u5230\u65b0\u7248\u672c\uff08v2\uff09\u3002"]}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"\u6838\u5fc3\u7406\u5ff5"}),"\uff1a\u65b0\u8001\u4ea4\u66ff\uff0c\u6e29\u6c34\u716e\u9752\u86d9\u3002K8s \u4e0d\u4f1a\u4e00\u6b21\u6027\u6740\u6389\u6240\u6709\u65e7\u5bb9\u5668\uff0c\u800c\u662f",(0,a.jsx)(s.strong,{children:"\u542f\u52a8\u4e00\u4e2a\u65b0\u5bb9\u5668 -> \u786e\u8ba4\u5b58\u6d3b -> \u6740\u6389\u4e00\u4e2a\u65e7\u5bb9\u5668"}),"\uff0c\u5982\u6b64\u5faa\u73af\uff0c\u76f4\u5230\u5168\u90e8\u66ff\u6362\u5b8c\u6210\u3002"]}),"\n",(0,a.jsx)(s.h3,{id:"12-\u6838\u5fc3\u539f\u7406replicaset-\u7684\u4ea4\u63a5\u68d2",children:"1.2 \u6838\u5fc3\u539f\u7406\uff1aReplicaSet \u7684\u4ea4\u63a5\u68d2"}),"\n",(0,a.jsx)(s.p,{children:"\u5f53\u6211\u4eec\u66f4\u65b0 Deployment \u7684\u955c\u50cf\u65f6\uff0cK8s \u5e95\u5c42\u5b9e\u9645\u53d1\u751f\u4e86\u4ee5\u4e0b\u52a8\u4f5c\uff1a"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:["Deployment \u521b\u5efa\u4e00\u4e2a\u65b0\u7684 ",(0,a.jsx)(s.strong,{children:"ReplicaSet (v2)"}),"\uff0c\u521d\u59cb\u526f\u672c\u6570\u4e3a 0\u3002"]}),"\n",(0,a.jsx)(s.li,{children:"Deployment \u6307\u6325 v2 ReplicaSet \u589e\u52a0\u526f\u672c\uff08\u6269\u5bb9\uff09\u3002"}),"\n",(0,a.jsxs)(s.li,{children:["\u5f53 v2 \u7684 Pod \u51c6\u5907\u5c31\u7eea\uff08Ready\uff09\u540e\uff0cDeployment \u6307\u6325\u65e7\u7684 ",(0,a.jsx)(s.strong,{children:"ReplicaSet (v1)"})," \u51cf\u5c11\u526f\u672c\uff08\u7f29\u5bb9\uff09\u3002"]}),"\n",(0,a.jsx)(s.li,{children:"\u91cd\u590d\u4e0a\u8ff0\u6b65\u9aa4\uff0c\u76f4\u5230 v1 \u526f\u672c\u6570\u4e3a 0\uff0cv2 \u526f\u672c\u6570\u8fbe\u5230\u671f\u671b\u503c\u3002"}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"13-\u5173\u952e\u914d\u7f6e\u53c2\u6570",children:"1.3 \u5173\u952e\u914d\u7f6e\u53c2\u6570"}),"\n",(0,a.jsxs)(s.p,{children:["\u5728 Deployment \u7684 YAML \u4e2d\uff0c\u901a\u8fc7 ",(0,a.jsx)(s.code,{children:"strategy"})," \u5b57\u6bb5\u63a7\u5236\u66f4\u65b0\u8282\u594f\uff1a"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-yaml",children:"spec:\n  replicas: 10\n  strategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxSurge: 2        # \u6fc0\u589e\u6570\uff1a\u5141\u8bb8\u6bd4\u671f\u671b\u526f\u672c\u6570\u591a\u51e0\u4e2a\uff1f\n      maxUnavailable: 0  # \u4e0d\u53ef\u7528\u6570\uff1a\u5141\u8bb8\u53d1\u5e03\u8fc7\u7a0b\u4e2d\u5c11\u51e0\u4e2a\uff1f\n"})}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"maxSurge (\u6700\u5927\u6fc0\u589e\u6570)"}),"\uff1a"]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["\u8bbe\u7f6e\u4e3a ",(0,a.jsx)(s.code,{children:"2"})," \u6216 ",(0,a.jsx)(s.code,{children:"20%"}),"\u3002\u8868\u793a\u5728\u53d1\u5e03\u8fc7\u7a0b\u4e2d\uff0c\u6700\u591a\u53ef\u4ee5\u5b58\u5728 ",(0,a.jsx)(s.code,{children:"10 + 2 = 12"})," \u4e2a Pod\u3002"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.em,{children:"\u4f5c\u7528"}),"\uff1a\u5148\u542f\u52a8\u65b0 Pod\uff0c\u786e\u4fdd\u8d44\u6e90\u8db3\u591f\u540e\u518d\u5220\u65e7\u7684\u3002"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"maxUnavailable (\u6700\u5927\u4e0d\u53ef\u7528\u6570)"}),"\uff1a"]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["\u8bbe\u7f6e\u4e3a ",(0,a.jsx)(s.code,{children:"0"}),"\u3002\u8868\u793a\u5728\u53d1\u5e03\u8fc7\u7a0b\u4e2d\uff0c",(0,a.jsx)(s.strong,{children:"\u4efb\u4f55\u65f6\u523b"}),"\u53ef\u7528\u7684 Pod \u6570\u91cf\u90fd\u4e0d\u80fd\u5c11\u4e8e 10 \u4e2a\u3002"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.em,{children:"\u4f5c\u7528"}),"\uff1a\u4fdd\u8bc1\u670d\u52a1\u5904\u7406\u80fd\u529b\u4e0d\u4e0b\u964d\uff0c\u9002\u5408\u5bf9\u7a33\u5b9a\u6027\u8981\u6c42\u6781\u9ad8\u7684\u573a\u666f\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"14-\u5fc5\u4e0d\u53ef\u5c11\u7684\u673a\u5236readiness-probe-\u5c31\u7eea\u63a2\u9488",children:"1.4 \u5fc5\u4e0d\u53ef\u5c11\u7684\u673a\u5236\uff1aReadiness Probe (\u5c31\u7eea\u63a2\u9488)"}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.strong,{children:"\u8fd9\u662f\u70ed\u66f4\u65b0\u6210\u529f\u7684\u5173\u952e\uff01"})}),"\n",(0,a.jsx)(s.p,{children:'\u5982\u679c\u6ca1\u914d\u63a2\u9488\uff0cPod \u4e00\u542f\u52a8\uff08\u5bb9\u5668\u8fdb\u7a0b\u8dd1\u8d77\u6765\uff09\uff0cK8s \u5c31\u8ba4\u4e3a\u5b83"\u597d\u4e86"\uff0c\u7acb\u9a6c\u5207\u65ad\u65e7 Pod\u3002\u5982\u679c\u65b0\u7a0b\u5e8f\u542f\u52a8\u6162\uff08\u6bd4\u5982 Java \u52a0\u8f7d Spring\uff09\uff0c\u6d41\u91cf\u6253\u8fdb\u6765\u5c31\u4f1a\u62a5\u9519\u3002'}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"\u914d\u7f6e\u793a\u4f8b"}),"\uff1a"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-yaml",children:"spec:\n  containers:\n  - name: my-app\n    image: my-app:v2\n    # \u544a\u8bc9 K8s\uff1a\u6211\u4e0d\u53ea\u6d3b\u4e86\uff0c\u6211\u8fd8\u51c6\u5907\u597d\u63a5\u5ba2\u4e86\n    readinessProbe:\n      httpGet:\n        path: /healthz\n        port: 8080\n      initialDelaySeconds: 5  # \u542f\u52a8\u540e\u7b495\u79d2\u518d\u5f00\u59cb\u67e5\n      periodSeconds: 10       # \u6bcf10\u79d2\u67e5\u4e00\u6b21\n"})}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"\u903b\u8f91"}),"\uff1a\u53ea\u6709\u5f53 ",(0,a.jsx)(s.code,{children:"readinessProbe"})," \u68c0\u6d4b\u6210\u529f\uff08\u8fd4\u56de 200\uff09\uff0cK8s \u624d\u4f1a\u628a\u8fd9\u4e2a\u65b0 Pod \u6807\u8bb0\u4e3a ",(0,a.jsx)(s.code,{children:"Ready"}),"\uff0c\u624d\u4f1a\u628a\u6d41\u91cf\u5207\u7ed9\u5b83\uff0c\u5e76\u5f00\u59cb\u5220\u9664\u65e7 Pod\u3002"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"15-\u5e38\u7528\u547d\u4ee4",children:"1.5 \u5e38\u7528\u547d\u4ee4"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"# \u89e6\u53d1\u66f4\u65b0\nkubectl set image deployment/myapp nginx=nginx:1.19\n\n# \u67e5\u770b\u8fdb\u5ea6\nkubectl rollout status deployment/myapp\n\n# \u540e\u6094\u4e86\uff08\u56de\u6eda\uff09\nkubectl rollout undo deployment/myapp\n"})}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsx)(s.h2,{id:"2-\u81ea\u52a8\u6269\u7f29\u5bb9-hpa---horizontal-pod-autoscaler",children:"2. \u81ea\u52a8\u6269\u7f29\u5bb9 (HPA - Horizontal Pod Autoscaler)"}),"\n",(0,a.jsx)(s.h3,{id:"21-\u4ec0\u4e48\u662f-hpa",children:"2.1 \u4ec0\u4e48\u662f HPA\uff1f"}),"\n",(0,a.jsx)(s.p,{children:'HPA \u662f Kubernetes \u7684"\u5f39\u6027\u4f38\u7f29\u63a7\u5236\u5668"\u3002\u5b83\u50cf\u4e00\u4e2a\u4e0d\u77e5\u75b2\u5026\u7684\u7ba1\u7406\u5458\uff0c\u6bcf\u9694 15 \u79d2\uff08\u9ed8\u8ba4\uff09\u68c0\u67e5\u4e00\u6b21 Pod \u7684\u8d1f\u8f7d\u60c5\u51b5\u3002'}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"\u8d1f\u8f7d\u9ad8"}),"\uff1a\u81ea\u52a8\u589e\u52a0 Pod \u6570\u91cf\uff0c\u5206\u644a\u538b\u529b\u3002"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"\u8d1f\u8f7d\u4f4e"}),"\uff1a\u81ea\u52a8\u51cf\u5c11 Pod \u6570\u91cf\uff0c\u8282\u7701\u670d\u52a1\u5668\u8d44\u6e90\uff08\u7701\u94b1\uff09\u3002"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"22-\u5de5\u4f5c\u6d41\u7a0b-the-control-loop",children:"2.2 \u5de5\u4f5c\u6d41\u7a0b (The Control Loop)"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"\u6536\u96c6\u6570\u636e"}),"\uff1a",(0,a.jsx)(s.code,{children:"Metrics Server"})," \u4ece\u5404\u4e2a Pod \u6536\u96c6 CPU \u548c\u5185\u5b58\u4f7f\u7528\u7387\u3002"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"\u8ba1\u7b97\u9700\u6c42"}),"\uff1aHPA \u63a7\u5236\u5668\u6839\u636e\u4f60\u8bbe\u5b9a\u7684\u516c\u5f0f\u8ba1\u7b97\u6240\u9700\u7684 Pod \u6570\u91cf\u3002"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"\u6267\u884c\u6307\u4ee4"}),"\uff1aHPA \u4fee\u6539 Deployment \u7684 ",(0,a.jsx)(s.code,{children:"replicas"})," \u6570\u91cf\u3002"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"\u6700\u7ec8\u843d\u5730"}),"\uff1aDeployment \u8d1f\u8d23\u521b\u5efa\u6216\u9500\u6bc1 Pod\u3002"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"23-\u6838\u5fc3\u7b97\u6cd5",children:"2.3 \u6838\u5fc3\u7b97\u6cd5"}),"\n",(0,a.jsx)(s.p,{children:"HPA \u4f7f\u7528\u4ee5\u4e0b\u516c\u5f0f\u6765\u51b3\u5b9a\u6269\u5bb9\u8fd8\u662f\u7f29\u5bb9\uff1a"}),"\n",(0,a.jsx)(s.span,{className:"katex-display",children:(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mtext,{children:"\u671f\u671b\u526f\u672c\u6570"}),(0,a.jsx)(s.mo,{children:"="}),(0,a.jsx)(s.mo,{stretchy:"false",children:"\u2308"}),(0,a.jsx)(s.mtext,{children:"\u5f53\u524d\u526f\u672c\u6570"}),(0,a.jsx)(s.mo,{children:"\xd7"}),(0,a.jsxs)(s.mfrac,{children:[(0,a.jsx)(s.mtext,{children:"\u5f53\u524d\u6307\u6807\u503c"}),(0,a.jsx)(s.mtext,{children:"\u76ee\u6807\u6307\u6807\u503c"})]}),(0,a.jsx)(s.mo,{stretchy:"false",children:"\u2309"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"\u671f\u671b\u526f\u672c\u6570 = \\lceil \u5f53\u524d\u526f\u672c\u6570 \\times \\frac{\u5f53\u524d\u6307\u6807\u503c}{\u76ee\u6807\u6307\u6807\u503c} \\rceil"})]})})}),(0,a.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.6833em"}}),(0,a.jsx)(s.span,{className:"mord cjk_fallback",children:"\u671f\u671b\u526f\u672c\u6570"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(s.span,{className:"mrel",children:"="}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mopen",children:"\u2308"}),(0,a.jsx)(s.span,{className:"mord cjk_fallback",children:"\u5f53\u524d\u526f\u672c\u6570"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(s.span,{className:"mbin",children:"\xd7"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"2.0463em",verticalAlign:"-0.686em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mopen nulldelimiter"}),(0,a.jsx)(s.span,{className:"mfrac",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsxs)(s.span,{className:"vlist",style:{height:"1.3603em"},children:[(0,a.jsxs)(s.span,{style:{top:"-2.314em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord cjk_fallback",children:"\u76ee\u6807\u6307\u6807\u503c"})})]}),(0,a.jsxs)(s.span,{style:{top:"-3.23em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,a.jsxs)(s.span,{style:{top:"-3.677em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsx)(s.span,{className:"mord cjk_fallback",children:"\u5f53\u524d\u6307\u6807\u503c"})})]})]}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.686em"},children:(0,a.jsx)(s.span,{})})})]})}),(0,a.jsx)(s.span,{className:"mclose nulldelimiter"})]}),(0,a.jsx)(s.span,{className:"mclose",children:"\u2309"})]})]})]})}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"\u4e3e\u4f8b"}),"\uff1a"]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["\u5f53\u524d\u6709 ",(0,a.jsx)(s.strong,{children:"2"})," \u4e2a Pod\u3002"]}),"\n",(0,a.jsxs)(s.li,{children:["\u4f60\u8bbe\u5b9a\u76ee\u6807 CPU \u4f7f\u7528\u7387\u662f ",(0,a.jsx)(s.strong,{children:"50%"}),"\u3002"]}),"\n",(0,a.jsxs)(s.li,{children:["\u73b0\u5728\u7a81\u53d1\u6d41\u91cf\uff0c\u6bcf\u4e2a Pod \u7684 CPU \u98d9\u5347\u5230\u4e86 ",(0,a.jsx)(s.strong,{children:"90%"}),"\u3002"]}),"\n",(0,a.jsxs)(s.li,{children:["\u8ba1\u7b97\uff1a",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mo,{stretchy:"false",children:"\u2308"}),(0,a.jsx)(s.mn,{children:"2"}),(0,a.jsx)(s.mo,{children:"\xd7"}),(0,a.jsxs)(s.mfrac,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mn,{children:"90"}),(0,a.jsx)(s.mi,{mathvariant:"normal",children:"%"})]}),(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mn,{children:"50"}),(0,a.jsx)(s.mi,{mathvariant:"normal",children:"%"})]})]}),(0,a.jsx)(s.mo,{stretchy:"false",children:"\u2309"}),(0,a.jsx)(s.mo,{children:"="}),(0,a.jsx)(s.mo,{stretchy:"false",children:"\u2308"}),(0,a.jsx)(s.mn,{children:"3.6"}),(0,a.jsx)(s.mo,{stretchy:"false",children:"\u2309"}),(0,a.jsx)(s.mo,{children:"="}),(0,a.jsx)(s.mn,{children:"4"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"\\lceil 2 \\times \\frac{90\\%}{50\\%} \\rceil = \\lceil 3.6 \\rceil = 4"})]})})}),(0,a.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mopen",children:"\u2308"}),(0,a.jsx)(s.span,{className:"mord",children:"2"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(s.span,{className:"mbin",children:"\xd7"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1.3029em",verticalAlign:"-0.3839em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mopen nulldelimiter"}),(0,a.jsx)(s.span,{className:"mfrac",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsxs)(s.span,{className:"vlist",style:{height:"0.919em"},children:[(0,a.jsxs)(s.span,{style:{top:"-2.655em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:"50%"})})})]}),(0,a.jsxs)(s.span,{style:{top:"-3.23em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,a.jsxs)(s.span,{style:{top:"-3.394em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:"90%"})})})]})]}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.3839em"},children:(0,a.jsx)(s.span,{})})})]})}),(0,a.jsx)(s.span,{className:"mclose nulldelimiter"})]}),(0,a.jsx)(s.span,{className:"mclose",children:"\u2309"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(s.span,{className:"mrel",children:"="}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mopen",children:"\u2308"}),(0,a.jsx)(s.span,{className:"mord",children:"3.6"}),(0,a.jsx)(s.span,{className:"mclose",children:"\u2309"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(s.span,{className:"mrel",children:"="}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.6444em"}}),(0,a.jsx)(s.span,{className:"mord",children:"4"})]})]})]})]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"\u7ed3\u679c"}),"\uff1aK8s \u4f1a\u5c06 Pod \u6269\u5bb9\u5230 4 \u4e2a\u3002"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"24-\u5b9e\u65bd-hpa-\u7684\u786c\u6027\u524d\u63d0",children:"2.4 \u5b9e\u65bd HPA \u7684\u786c\u6027\u524d\u63d0"}),"\n",(0,a.jsx)(s.p,{children:"\u8981\u4f7f\u7528 HPA\uff0c\u4f60\u5fc5\u987b\u505a\u4e24\u4ef6\u4e8b\uff1a"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"\u96c6\u7fa4\u5fc5\u987b\u5b89\u88c5 Metrics Server"}),"\uff1a\u8fd9\u662f HPA \u7684\u773c\u775b\uff0c\u6ca1\u6709\u5b83 HPA \u8bfb\u4e0d\u5230 CPU \u6570\u636e\u3002"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Deployment \u5fc5\u987b\u914d\u7f6e Request \u8d44\u6e90\u9650\u5236"}),"\uff1aHPA \u662f\u6839\u636e\u767e\u5206\u6bd4\u8ba1\u7b97\u7684\uff0c\u5982\u679c\u4f60\u6ca1\u544a\u8bc9 K8s \u5206\u6bcd\uff08Request\uff09\u662f\u591a\u5c11\uff0c\u5b83\u7b97\u4e0d\u51fa\u767e\u5206\u6bd4\u3002"]}),"\n"]}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"YAML \u914d\u7f6e\u793a\u4f8b"}),"\uff1a"]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.strong,{children:'\u7b2c\u4e00\u6b65\uff1a\u5728 Deployment \u91cc\u5b9a\u4e49"\u5206\u6bcd"'})}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-yaml",children:"containers:\n- name: php-apache\n  image: k8s.gcr.io/hpa-example\n  resources:\n    requests: # \u5fc5\u987b\u914d\u7f6e\u8fd9\u4e2a\uff01\n      cpu: 200m  # 200\u6beb\u6838\uff080.2\u6838\uff09\n"})}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.strong,{children:"\u7b2c\u4e8c\u6b65\uff1a\u521b\u5efa HPA \u89c4\u5219"})}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-yaml",children:"apiVersion: autoscaling/v1\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: php-apache-hpa\nspec:\n  scaleTargetRef:\n    apiVersion: apps/v1\n    kind: Deployment\n    name: php-apache\n  minReplicas: 1   # \u65e0\u8bba\u591a\u95f2\uff0c\u81f3\u5c11\u4fdd\u75591\u4e2a\n  maxReplicas: 10  # \u65e0\u8bba\u591a\u5fd9\uff0c\u6700\u591a\u5f0010\u4e2a\uff08\u9632\u6b62\u8d44\u6e90\u8017\u5c3d\uff09\n  targetCPUUtilizationPercentage: 50 # \u7ef4\u6301\u5728 50% \u5229\u7528\u7387\n"})}),"\n",(0,a.jsx)(s.h3,{id:"25-\u6269\u7f29\u5bb9\u7684\u9632\u6296\u52a8\u673a\u5236",children:'2.5 \u6269\u7f29\u5bb9\u7684"\u9632\u6296\u52a8"\u673a\u5236'}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"\u6269\u5bb9\uff08Scale Up\uff09"}),"\uff1a\u975e\u5e38\u6fc0\u8fdb\u3002\u4e00\u65e6\u68c0\u6d4b\u5230\u8d1f\u8f7d\u8d85\u6807\uff0c\u51e0\u5206\u949f\u5185\u5c31\u4f1a\u628a Pod \u52a0\u6ee1\uff0c\u4e3a\u4e86\u5feb\u901f\u6297\u4f4f\u6d41\u91cf\u3002"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"\u7f29\u5bb9\uff08Scale Down\uff09"}),"\uff1a\u975e\u5e38\u4fdd\u5b88\u3002\u9ed8\u8ba4\u6709\u4e00\u4e2a ",(0,a.jsx)(s.strong,{children:"5\u5206\u949f\u7684\u51b7\u5374\u671f (Stabilization Window)"}),"\u3002","\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.em,{children:"\u4e3a\u4ec0\u4e48\uff1f"})," \u9632\u6b62\u6d41\u91cf\u5ffd\u9ad8\u5ffd\u4f4e\u5bfc\u81f4 Pod \u521a\u5220\u6389\u53c8\u8981\u521b\u5efa\uff08\u6296\u52a8\uff09\u3002\u53ea\u6709\u6301\u7eed 5 \u5206\u949f\u8d1f\u8f7d\u90fd\u5f88\u4f4e\uff0cK8s \u624d\u4f1a\u771f\u7684\u5f00\u59cb\u5220 Pod\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsx)(s.h2,{id:"3-\u4e24\u8005\u5982\u4f55\u914d\u5408\u5de5\u4f5c",children:"3. \u4e24\u8005\u5982\u4f55\u914d\u5408\u5de5\u4f5c\uff1f"}),"\n",(0,a.jsxs)(s.p,{children:["\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c",(0,a.jsx)(s.strong,{children:"\u70ed\u66f4\u65b0"}),"\u548c",(0,a.jsx)(s.strong,{children:"HPA"}),"\u662f\u540c\u65f6\u5de5\u4f5c\u7684\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\uff1a"]}),"\n",(0,a.jsxs)(s.blockquote,{children:["\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.em,{children:"\u6b63\u5728\u53d1\u65b0\u7248\u672c\uff08\u70ed\u66f4\u65b0\u4e2d\uff09\uff0c\u7a81\u7136\u6d41\u91cf\u66b4\u6da8\uff08\u89e6\u53d1 HPA\uff09\uff0c\u4f1a\u6253\u67b6\u5417\uff1f"})}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.strong,{children:"\u7b54\u6848\u662f\uff1a\u4e0d\u4f1a\uff0c\u5b83\u4eec\u914d\u5408\u5f97\u5f88\u597d\u3002"})}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"HPA \u62e5\u6709\u6700\u9ad8\u6307\u6325\u6743"}),"\uff1aHPA \u5e76\u4e0d\u5173\u5fc3\u4f60\u7528\u7684\u662f v1 \u8fd8\u662f v2 \u955c\u50cf\uff0c\u5b83\u53ea\u770b CPU\u3002\u5982\u679c CPU \u9ad8\u4e86\uff0c\u5b83\u76f4\u63a5\u4fee\u6539 Deployment \u7684 ",(0,a.jsx)(s.code,{children:"replicas"})," \u603b\u6570\uff08\u6bd4\u5982\u4ece 3 \u6539\u5230 6\uff09\u3002"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Deployment \u8d1f\u8d23\u6267\u884c"}),"\uff1aDeployment \u6536\u5230 ",(0,a.jsx)(s.code,{children:"replicas=6"})," \u7684\u6307\u4ee4\u540e\uff0c\u4f1a\u6839\u636e\u5f53\u524d\u7684\u6eda\u52a8\u66f4\u65b0\u7b56\u7565\uff0c\u6309\u6bd4\u4f8b\u53bb\u589e\u52a0 v1 \u6216 v2 \u7684 Pod\uff0c\u6700\u7ec8\u8fbe\u5230\u603b\u6570 6 \u4e2a\u3002"]}),"\n"]}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsx)(s.h2,{id:"\u6700\u4f73\u5b9e\u8df5\u603b\u7ed3",children:"\u6700\u4f73\u5b9e\u8df5\u603b\u7ed3"}),"\n",(0,a.jsxs)(s.table,{children:[(0,a.jsx)(s.thead,{children:(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.th,{children:"\u529f\u80fd"}),(0,a.jsx)(s.th,{children:"\u6838\u5fc3\u4f5c\u7528"}),(0,a.jsx)(s.th,{children:"\u5173\u952e\u914d\u7f6e\u9879"}),(0,a.jsx)(s.th,{children:"\u6ce8\u610f\u4e8b\u9879"})]})}),(0,a.jsxs)(s.tbody,{children:[(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.strong,{children:"\u70ed\u66f4\u65b0"})}),(0,a.jsx)(s.td,{children:"\u5e73\u6ed1\u53d1\u5e03\u4ee3\u7801\uff0c\u96f6\u505c\u673a"}),(0,a.jsxs)(s.td,{children:[(0,a.jsx)(s.code,{children:"maxSurge"}),", ",(0,a.jsx)(s.code,{children:"maxUnavailable"})]}),(0,a.jsxs)(s.td,{children:[(0,a.jsx)(s.strong,{children:"\u4e00\u5b9a\u8981\u914d Readiness Probe"}),"\uff0c\u5426\u5219\u7b49\u4e8e\u662f\u5728\u88f8\u5954\uff0c\u5bb9\u6613\u53d1\u5e03\u5373\u5d29\u6e83\u3002"]})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.strong,{children:"HPA"})}),(0,a.jsx)(s.td,{children:"\u6839\u636e\u6d41\u91cf\u81ea\u52a8\u4f38\u7f29\uff0c\u6297\u538b\u4e14\u7701\u94b1"}),(0,a.jsxs)(s.td,{children:[(0,a.jsx)(s.code,{children:"minReplicas"}),", ",(0,a.jsx)(s.code,{children:"maxReplicas"}),", ",(0,a.jsx)(s.code,{children:"targetCPU"})]}),(0,a.jsxs)(s.td,{children:[(0,a.jsx)(s.strong,{children:"\u4e00\u5b9a\u8981\u914d resources.requests"}),"\uff0c\u5426\u5219 HPA \u4e0d\u751f\u6548\u3002"]})]})]})]})]})}function o(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}}}]);