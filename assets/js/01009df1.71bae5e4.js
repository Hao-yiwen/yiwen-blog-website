"use strict";(globalThis.webpackChunkyiwen_blog_website=globalThis.webpackChunkyiwen_blog_website||[]).push([[20242],{2187:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>v,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"native/ReactNative/often_qs","title":"\u5e38\u89c1RN\u95ee\u9898","description":"1. \u5728RN\u6837\u5f0f\u4e2d\uff0czIndex\u5c42\u7ea7\u5728\u7edd\u5bf9\u5b9a\u4f4d\u4e0a\u9762\u3002","source":"@site/docs/native/ReactNative/often_qs.md","sourceDirName":"native/ReactNative","slug":"/native/ReactNative/often_qs","permalink":"/yiwen-blog-website/docs/native/ReactNative/often_qs","draft":false,"unlisted":false,"editUrl":"https://github.com/Hao-yiwen/yiwen-blog-website/tree/master/docs/native/ReactNative/often_qs.md","tags":[],"version":"current","frontMatter":{},"sidebar":"nativeSidebar","previous":{"title":"\u5220\u9664metro\u7f13\u5b58","permalink":"/yiwen-blog-website/docs/native/ReactNative/metro_cache_delete"},"next":{"title":"PanResponder","permalink":"/yiwen-blog-website/docs/native/ReactNative/panresponder"}}');var o=t(74848),i=t(28453);const s=t.p+"assets/images/web_render-888479a0b9378f0c5c7ad9f35db0c535.png",l={},d="\u5e38\u89c1RN\u95ee\u9898",a={},c=[{value:"\u4e3a\u4ec0\u4e48\u8fd9\u6837\u505a\uff1f",id:"\u4e3a\u4ec0\u4e48\u8fd9\u6837\u505a",level:3},{value:"\u4f46\u662f\u8fd9\u4e2a\u95ee\u9898\u7684\u6839\u56e0\u662f\u4ec0\u4e48\u5bfc\u81f4\u7684?",id:"\u4f46\u662f\u8fd9\u4e2a\u95ee\u9898\u7684\u6839\u56e0\u662f\u4ec0\u4e48\u5bfc\u81f4\u7684",level:3}];function m(e){const n={code:"code",h1:"h1",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"\u5e38\u89c1rn\u95ee\u9898",children:"\u5e38\u89c1RN\u95ee\u9898"})}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u5728RN\u6837\u5f0f\u4e2d\uff0czIndex\u5c42\u7ea7\u5728\u7edd\u5bf9\u5b9a\u4f4d\u4e0a\u9762\u3002"}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u5728\u4f7f\u7528\u65b0\u67b6\u6784\u7684\u65f6\u5019\u4ee5\u4e0b\u7684\u4ee3\u7801\u4f1a\u5c11\u6e32\u67d3\u4e00\u6b21\u3002\u3002"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"import React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { View, Text, Button, TextInput } from 'react-native';\n\n// \u6a21\u62df\u590d\u6742\u5f02\u6b65\u64cd\u4f5c\nconst simulateAsyncOperation = () => {\n    return new Promise(resolve => {\n        setTimeout(() => {\n            resolve('done');\n        }, 500); // \u6a21\u62df500ms\u7684\u5f02\u6b65\u64cd\u4f5c\n    });\n};\n\n// \u7b2c\u4e00\u5c42\u7ec4\u4ef6\nconst FirstLevelComponent = () => {\n    const [firstLevelState, setFirstLevelState] = useState('1111111111');\n\n    useEffect(() => {\n        console.log(performance.now() + ' FirstLevelComponent render time');\n        return () => {\n            console.log(\n                performance.now() + ' FirstLevelComponent remove render time'\n            );\n        };\n    });\n\n    return (\n        <View\n            style={{\n                padding: 20,\n                backgroundColor: '#f0f0f0',\n                marginBottom: 10,\n            }}\n        >\n            <Text>First Level Component</Text>\n            <Text>{firstLevelState}</Text>\n            <SecondLevelComponent setFirstLevelState={setFirstLevelState} />\n        </View>\n    );\n};\n\n// \u7b2c\u4e8c\u5c42\u7ec4\u4ef6\nconst SecondLevelComponent = ({ setFirstLevelState }) => {\n    const [secondLevelState, setSecondLevelState] = useState('1111111111');\n    const thirdInputRef = useRef(null);\n    const thirdViewRef = useRef(null);\n    const [isShowThirdLevel, setIsShowThirdLevel] = useState(true);\n\n    const updateFirstLevelState = useCallback(\n        async (ref, viewRef) => {\n            thirdInputRef.current = ref;\n            thirdViewRef.current = viewRef;\n            setSecondLevelState('2222222222');\n            await simulateAsyncOperation();\n            thirdInputRef.current.focus();\n            thirdViewRef.current.setNativeProps({\n                style: { backgroundColor: 'red' },\n            });\n            setFirstLevelState('2222222222');\n            setIsShowThirdLevel(false);\n        },\n        [setFirstLevelState]\n    );\n\n    useEffect(() => {\n        console.log(performance.now() + ' SecondLevelComponent render time');\n        return () => {\n            console.log(\n                performance.now() + ' SecondLevelComponent remove render time'\n            );\n        };\n    });\n\n    return (\n        <View\n            style={{\n                padding: 20,\n                backgroundColor: '#d0d0d0',\n                marginBottom: 10,\n            }}\n        >\n            <Text>Second Level Component</Text>\n            <Text>{secondLevelState}</Text>\n            {isShowThirdLevel && (\n                <ThirdLevelComponent\n                    setSecondLevelState={updateFirstLevelState}\n                />\n            )}\n        </View>\n    );\n};\n\n// \u7b2c\u4e09\u5c42\u7ec4\u4ef6\nconst ThirdLevelComponent = ({ setSecondLevelState }) => {\n    const [thirdLevelState, setThirdLevelState] = useState('11111');\n    const inputRef = useRef(null);\n    const viewRef = useRef(null);\n\n    const handleClick = () => {\n        // \u66f4\u65b0\u7b2c\u4e09\u5c42\u7ec4\u4ef6\u7684 state\n        setThirdLevelState('2222222');\n\n        // \u540c\u65f6\u89e6\u53d1\u7b2c\u4e8c\u5c42\u7ec4\u4ef6\u7684 hook\n        setTimeout(() => {\n            setSecondLevelState(inputRef.current, viewRef.current);\n        }, 100);\n    };\n\n    useEffect(() => {\n        return () => {\n            console.log(\n                performance.now() + ' ThirdLevelComponent remove render time'\n            );\n        };\n    });\n\n    return (\n        <View\n            style={{\n                padding: 20,\n                backgroundColor: '#b0b0b0',\n                marginBottom: 10,\n            }}\n            ref={viewRef}\n        >\n            <Text>Third Level Component</Text>\n            <Text>{thirdLevelState}</Text>\n            <TextInput placeholder=\"\u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u8f93\u5165\u6846\uff5e\" ref={inputRef} />\n            <Button title=\"Update State\" onPress={handleClick} />\n        </View>\n    );\n};\n\n// \u6e32\u67d3\u7b2c\u4e00\u5c42\u7ec4\u4ef6\nconst App = () => {\n    return (\n        <View style={{ padding: 50 }}>\n            <FirstLevelComponent />\n        </View>\n    );\n};\n\nexport default App;\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# \u65b0\u67b6\u6784\n (NOBRIDGE) LOG  247745574.715766 ThirdLevelComponent remove render time\n (NOBRIDGE) LOG  247745574.988997 ThirdLevelComponent render time\n (NOBRIDGE) LOG  247745683.98892 ThirdLevelComponent remove render time\n (NOBRIDGE) LOG  247745684.341843 SecondLevelComponent remove render time\n (NOBRIDGE) LOG  247745684.498535 ThirdLevelComponent render time\n (NOBRIDGE) LOG  247745684.610459 SecondLevelComponent render time\n (NOBRIDGE) LOG  247746203.461843 ThirdLevelComponent remove render time\n (NOBRIDGE) LOG  247746205.302459 SecondLevelComponent remove render time\n (NOBRIDGE) LOG  247746205.505535 FirstLevelComponent remove render time\n (NOBRIDGE) LOG  247746205.644689 SecondLevelComponent render time\n (NOBRIDGE) LOG  247746205.736612 FirstLevelComponent render time\n # 631ms - 500ms - 100ms = 31ms\n\n# \u8001\u67b6\u6784\n LOG  261633253.512666 ThirdLevelComponent remove render time\n LOG  261633253.633666 ThirdLevelComponent render time\n LOG  261633354.077541 ThirdLevelComponent remove render time\n LOG  261633354.18625 SecondLevelComponent remove render time\n LOG  261633354.270125 ThirdLevelComponent render time\n LOG  261633354.31675 SecondLevelComponent render time\n LOG  261633882.711375 ThirdLevelComponent remove render time\n LOG  261633882.887958 SecondLevelComponent remove render time\n LOG  261633882.9635 FirstLevelComponent remove render time\n LOG  261633883.056125 ThirdLevelComponent render time\n LOG  261633883.109208 SecondLevelComponent render time\n LOG  261633883.156125 FirstLevelComponent render time\n LOG  261633899.212166 ThirdLevelComponent remove render time\n LOG  261633900.514625 SecondLevelComponent remove render time\n LOG  261633900.587916 SecondLevelComponent render time\n # 647ms - 500ms - 100ms = 47ms\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u7248\u672c\u662f0.74.2\uff0c\u4ece\u8fd9\u6bb5\u4ee3\u7801\u53ef\u4ee5\u770b\u5230\u65b0\u67b6\u6784\u51cf\u5c11\u4e86\u6e32\u67d3\u5e27\uff0c\u63d0\u9ad8\u4e86\u6e32\u67d3\u901f\u5ea6\u3002\u4f46\u662f\u5728\u8001\u67b6\u6784\u5230\u65b0\u67b6\u6784\u7684\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\u5bb9\u6613\u5bfc\u81f4\u95ee\u9898\u3002"}),"\n",(0,o.jsx)(n.h3,{id:"\u4e3a\u4ec0\u4e48\u8fd9\u6837\u505a",children:"\u4e3a\u4ec0\u4e48\u8fd9\u6837\u505a\uff1f"}),"\n",(0,o.jsx)("img",{src:s,width:500}),"\n",(0,o.jsx)(n.p,{children:"\u4ece\u4e2d\u53ef\u4ee5\u770b\u5230react\u5728web\u6e32\u67d3\u5b8c\u5168\u548c\u65b0\u67b6\u6784\u4e00\u81f4\u5e76\u4e14\u56e0\u4e3a\u6ca1\u6709\u7ebf\u7a0b\u5207\u6362\u548c\u8de8\u8bed\u8a00\u7684\u8d44\u6e90\u6d88\u8017\uff0creact\u5728\u4e00\u5e27\u4e2d\u5c31\u80fd\u5b8c\u6210\u4e0a\u8ff0\u6e32\u67d3\u3002\u6240\u4ee5rn\u957f\u671f\u4ee5\u6765\u4e00\u81f4\u5728\u5411\u8fd9\u4e00\u65b9\u9762\u52aa\u529b\uff0c\u4eca\u5929\u6700\u8d77\u7801\u5728\u5b9e\u73b0\u4fa7\u5bf9\u9f50\u4e86\u3002"}),"\n",(0,o.jsx)(n.h3,{id:"\u4f46\u662f\u8fd9\u4e2a\u95ee\u9898\u7684\u6839\u56e0\u662f\u4ec0\u4e48\u5bfc\u81f4\u7684",children:"\u4f46\u662f\u8fd9\u4e2a\u95ee\u9898\u7684\u6839\u56e0\u662f\u4ec0\u4e48\u5bfc\u81f4\u7684?"}),"\n",(0,o.jsx)(n.p,{children:"\u5728\u6865\u63a5\u6e32\u67d3\u4e2d\uff0cshadowtree\u5e76\u6ca1\u6709\u7ef4\u62a4\u5728c++\u5c42\u9762\uff0c\u800c\u662f\u901a\u8fc7\u5f02\u6b65\u6d88\u606f\u5b58\u5728\u4e8ejava jvm\u7b49host\u5e73\u53f0\u4e2d\u3002\u6240\u4ee5\u5982\u679c\u8981\u8fdb\u884c\u5728\u53ea\u6709\u7b2c\u4e8c\u6b21\u6e32\u67d3\u540e\u624d\u80fd\u5c06\u7b2c\u4e09\u6b21\u6e32\u67d3\u540c\u7b2c\u4e8c\u6b21\u6e32\u67d3\u6bd4\u8f83\u3002"}),"\n",(0,o.jsx)(n.p,{children:"\u4f46\u662f\u65b0\u67b6\u6784\u8be5\u7528\u540c\u6b65\u67b6\u6784\uff0cjs\u76f4\u63a5\u8c03\u7528api\uff0c\u80fd\u505a\u5230\u65e0\u9700\u7b2c\u4e09\u6b21\u6e32\u67d3\u5c31\u80fd\u5c06\u6700\u7ec8tree\u7ed9\u6e32\u67d3\u51fa\u6765\u3002"})]})}function v(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(m,{...e})}):m(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>l});var r=t(96540);const o={},i=r.createContext(o);function s(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);