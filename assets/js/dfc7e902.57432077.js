"use strict";(globalThis.webpackChunkyiwen_blog_website=globalThis.webpackChunkyiwen_blog_website||[]).push([[71887],{413:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"ai/frameworks/pytorch/common-errors","title":"PyTorch \u5e38\u89c1\u9519\u8bef\u4e0e\u9677\u9631","description":"\u68af\u5ea6\u66f4\u65b0\uff1ain-place \u64cd\u4f5c vs \u91cd\u65b0\u8d4b\u503c","source":"@site/docs/ai/frameworks/pytorch/common-errors.md","sourceDirName":"ai/frameworks/pytorch","slug":"/ai/frameworks/pytorch/common-errors","permalink":"/yiwen-blog-website/docs/ai/frameworks/pytorch/common-errors","draft":false,"unlisted":false,"editUrl":"https://github.com/Hao-yiwen/yiwen-blog-website/tree/master/docs/ai/frameworks/pytorch/common-errors.md","tags":[],"version":"current","lastUpdatedAt":1765185541000,"frontMatter":{},"sidebar":"aiSidebar","previous":{"title":"PyTorch: cat vs stack \u5f20\u91cf\u62fc\u63a5","permalink":"/yiwen-blog-website/docs/ai/frameworks/pytorch/cat-vs-stack"},"next":{"title":"CPU \u52a0\u901f\u6548\u679c","permalink":"/yiwen-blog-website/docs/ai/frameworks/pytorch/cpu-acceleration"}}');var s=n(74848),l=n(28453);const d={},c="PyTorch \u5e38\u89c1\u9519\u8bef\u4e0e\u9677\u9631",o={},a=[{value:"\u68af\u5ea6\u66f4\u65b0\uff1ain-place \u64cd\u4f5c vs \u91cd\u65b0\u8d4b\u503c",id:"\u68af\u5ea6\u66f4\u65b0in-place-\u64cd\u4f5c-vs-\u91cd\u65b0\u8d4b\u503c",level:2},{value:"\u95ee\u9898",id:"\u95ee\u9898",level:3},{value:"\u6838\u5fc3\u533a\u522b",id:"\u6838\u5fc3\u533a\u522b",level:2},{value:"<code>w -= lr * w.grad</code>\uff08\u2705 \u6b63\u786e\uff09",id:"w---lr--wgrad-\u6b63\u786e",level:3},{value:"<code>w = w - lr * w.grad</code>\uff08\u274c \u9519\u8bef\uff09",id:"w--w---lr--wgrad-\u9519\u8bef",level:3},{value:"\u63a8\u8350\u5199\u6cd5",id:"\u63a8\u8350\u5199\u6cd5",level:2},{value:"\u2705 \u624b\u5199\u68af\u5ea6\u4e0b\u964d",id:"-\u624b\u5199\u68af\u5ea6\u4e0b\u964d",level:3},{value:"\u2705 \u4f7f\u7528\u4f18\u5316\u5668",id:"-\u4f7f\u7528\u4f18\u5316\u5668",level:3},{value:"\u5e38\u89c1\u62a5\u9519",id:"\u5e38\u89c1\u62a5\u9519",level:2},{value:"\u4e00\u53e5\u8bdd\u603b\u7ed3",id:"\u4e00\u53e5\u8bdd\u603b\u7ed3",level:2},{value:"\u76f8\u5173\u6587\u6863",id:"\u76f8\u5173\u6587\u6863",level:2}];function t(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"pytorch-\u5e38\u89c1\u9519\u8bef\u4e0e\u9677\u9631",children:"PyTorch \u5e38\u89c1\u9519\u8bef\u4e0e\u9677\u9631"})}),"\n",(0,s.jsx)(r.h2,{id:"\u68af\u5ea6\u66f4\u65b0in-place-\u64cd\u4f5c-vs-\u91cd\u65b0\u8d4b\u503c",children:"\u68af\u5ea6\u66f4\u65b0\uff1ain-place \u64cd\u4f5c vs \u91cd\u65b0\u8d4b\u503c"}),"\n",(0,s.jsx)(r.h3,{id:"\u95ee\u9898",children:"\u95ee\u9898"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsxs)(r.strong,{children:["\u4e3a\u4ec0\u4e48\u5728 ",(0,s.jsx)(r.code,{children:"torch.no_grad()"})," \u4e2d\uff0c",(0,s.jsx)(r.code,{children:"w -= lr * w.grad"})," \u548c ",(0,s.jsx)(r.code,{children:"w = w - lr * w.grad"})," \u7684\u884c\u4e3a\u5b8c\u5168\u4e0d\u540c\uff1f"]})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-python",children:"# \u65b9\u5f0f1\uff1a\u539f\u5730\u64cd\u4f5c\nwith torch.no_grad():\n    w -= lr * w.grad  # \u2705 \u63a8\u8350\n\n# \u65b9\u5f0f2\uff1a\u91cd\u65b0\u8d4b\u503c\nwith torch.no_grad():\n    w = w - lr * w.grad  # \u274c \u9519\u8bef\uff01w.requires_grad \u4f1a\u53d8\u6210 False\n"})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"\u6838\u5fc3\u533a\u522b",children:"\u6838\u5fc3\u533a\u522b"}),"\n",(0,s.jsxs)(r.h3,{id:"w---lr--wgrad-\u6b63\u786e",children:[(0,s.jsx)(r.code,{children:"w -= lr * w.grad"}),"\uff08\u2705 \u6b63\u786e\uff09"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"in-place \u64cd\u4f5c"}),"\uff0c\u4e0d\u521b\u5efa\u65b0\u5f20\u91cf"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"w"})," \u8fd8\u662f\u539f\u6765\u7684\u5bf9\u8c61\uff0c",(0,s.jsx)(r.code,{children:"w.requires_grad"})," \u4f9d\u7136\u662f ",(0,s.jsx)(r.code,{children:"True"})]}),"\n",(0,s.jsx)(r.li,{children:"\u53ea\u662f\u6570\u503c\u6539\u53d8\u4e86\uff0c\u4e0b\u4e00\u8f6e\u4ecd\u4f1a\u8ba1\u7b97\u68af\u5ea6"}),"\n"]}),"\n",(0,s.jsxs)(r.h3,{id:"w--w---lr--wgrad-\u9519\u8bef",children:[(0,s.jsx)(r.code,{children:"w = w - lr * w.grad"}),"\uff08\u274c \u9519\u8bef\uff09"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"\u521b\u5efa\u65b0\u5f20\u91cf"}),"\uff0c\u5728 ",(0,s.jsx)(r.code,{children:"no_grad()"})," \u4e2d\u8ba1\u7b97"]}),"\n",(0,s.jsxs)(r.li,{children:["\u65b0\u5f20\u91cf\u7684 ",(0,s.jsx)(r.code,{children:"requires_grad"})," \u662f ",(0,s.jsx)(r.code,{children:"False"})]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"w"})," \u6307\u5411\u65b0\u5f20\u91cf\u540e\uff0c\u4e0b\u4e00\u8f6e\u4e0d\u4f1a\u518d\u8ba1\u7b97\u68af\u5ea6"]}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"\u66f4\u4e25\u91cd\u7684\u9677\u9631\uff1a"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-python",children:"# \u5982\u679c w \u662f nn.Parameter\nmodel.linear.weight = model.linear.weight - lr * model.linear.weight.grad\n# \u274c \u53f3\u8fb9\u662f\u666e\u901a Tensor\uff0c\u4e0d\u662f nn.Parameter\n# \u274c \u4f18\u5316\u5668\u548c model.parameters() \u91cc\u627e\u4e0d\u5230\u5b83\u4e86\uff01\n"})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"\u63a8\u8350\u5199\u6cd5",children:"\u63a8\u8350\u5199\u6cd5"}),"\n",(0,s.jsx)(r.h3,{id:"-\u624b\u5199\u68af\u5ea6\u4e0b\u964d",children:"\u2705 \u624b\u5199\u68af\u5ea6\u4e0b\u964d"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-python",children:"for x, y in data:\n    pred = model(x)\n    loss = criterion(pred, y)\n    loss.backward()\n\n    with torch.no_grad():\n        for p in model.parameters():\n            p -= lr * p.grad  # \u4f7f\u7528 in-place \u64cd\u4f5c\n            p.grad.zero_()\n"})}),"\n",(0,s.jsx)(r.h3,{id:"-\u4f7f\u7528\u4f18\u5316\u5668",children:"\u2705 \u4f7f\u7528\u4f18\u5316\u5668"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-python",children:"optimizer = torch.optim.SGD(model.parameters(), lr=0.01)\n\nfor x, y in data:\n    optimizer.zero_grad()\n    loss = criterion(model(x), y)\n    loss.backward()\n    optimizer.step()\n"})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"\u5e38\u89c1\u62a5\u9519",children:"\u5e38\u89c1\u62a5\u9519"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"RuntimeError: a leaf Variable that requires grad is being used in an in-place operation\n"})}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"\u539f\u56e0\uff1a"})," \u6ca1\u6709\u7528 ",(0,s.jsx)(r.code,{children:"torch.no_grad()"})," \u5305\u88f9 in-place \u64cd\u4f5c"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-python",children:"# \u274c \u6ca1\u6709 no_grad()\nw -= lr * w.grad  # \u62a5\u9519\uff01\n"})}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"\u89e3\u51b3\uff1a"})," \u52a0\u4e0a ",(0,s.jsx)(r.code,{children:"with torch.no_grad()"})]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"\u4e00\u53e5\u8bdd\u603b\u7ed3",children:"\u4e00\u53e5\u8bdd\u603b\u7ed3"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"w -= lr * w.grad"})}),"\uff1a\u539f\u5730\u6539\u503c\uff0c",(0,s.jsx)(r.code,{children:"w"})," \u8fd8\u662f\u9700\u8981\u68af\u5ea6\u7684\u53c2\u6570 \u2705"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"w = w - lr * w.grad"})}),"\uff1a\u521b\u5efa\u65b0\u5f20\u91cf\uff0c",(0,s.jsx)(r.code,{children:"requires_grad"})," \u53d8 ",(0,s.jsx)(r.code,{children:"False"})," \u274c"]}),"\n"]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"\u76f8\u5173\u6587\u6863",children:"\u76f8\u5173\u6587\u6863"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"/yiwen-blog-website/docs/ai/fundamentals/training/autograd-mechanism",children:"PyTorch \u81ea\u52a8\u6c42\u5bfc\u673a\u5236"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"/yiwen-blog-website/docs/ai/fundamentals/training/computational_graph",children:"PyTorch \u8ba1\u7b97\u56fe\u8be6\u89e3"})}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,l.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},28453:(e,r,n)=>{n.d(r,{R:()=>d,x:()=>c});var i=n(96540);const s={},l=i.createContext(s);function d(e){const r=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),i.createElement(l.Provider,{value:r},e.children)}}}]);