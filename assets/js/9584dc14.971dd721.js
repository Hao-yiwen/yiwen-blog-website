"use strict";(globalThis.webpackChunkyiwen_blog_website=globalThis.webpackChunkyiwen_blog_website||[]).push([[16473],{28453(s,e,a){a.d(e,{R:()=>i,x:()=>r});var n=a(96540);const l={},t=n.createContext(l);function i(s){const e=n.useContext(t);return n.useMemo(function(){return"function"==typeof s?s(e):{...e,...s}},[e,s])}function r(s){let e;return e=s.disableParentContext?"function"==typeof s.components?s.components(l):s.components||l:i(s.components),n.createElement(t.Provider,{value:e},s.children)}},92251(s,e,a){a.r(e),a.d(e,{assets:()=>m,contentTitle:()=>r,default:()=>x,frontMatter:()=>i,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"ai/architectures/transformer/rmsnorm","title":"RMSNorm (Root Mean Square Normalization)","description":"RMSNorm (Root Mean Square Normalization) \u53ef\u4ee5\u88ab\u89c6\u4e3a LayerNorm (Layer Normalization) \u7684\\"\u7b80\u5316\u7248\\"\u6216\\"\u52a0\u901f\u7248\\"\u3002","source":"@site/docs/ai/architectures/transformer/rmsnorm.md","sourceDirName":"ai/architectures/transformer","slug":"/ai/architectures/transformer/rmsnorm","permalink":"/yiwen-blog-website/docs/ai/architectures/transformer/rmsnorm","draft":false,"unlisted":false,"editUrl":"https://github.com/Hao-yiwen/yiwen-blog-website/tree/master/docs/ai/architectures/transformer/rmsnorm.md","tags":[{"inline":true,"label":"transformer","permalink":"/yiwen-blog-website/docs/tags/transformer"},{"inline":true,"label":"normalization","permalink":"/yiwen-blog-website/docs/tags/normalization"},{"inline":true,"label":"rmsnorm","permalink":"/yiwen-blog-website/docs/tags/rmsnorm"},{"inline":true,"label":"layernorm","permalink":"/yiwen-blog-website/docs/tags/layernorm"},{"inline":true,"label":"llama","permalink":"/yiwen-blog-website/docs/tags/llama"},{"inline":true,"label":"llm","permalink":"/yiwen-blog-website/docs/tags/llm"}],"version":"current","lastUpdatedAt":1765065600000,"frontMatter":{"title":"RMSNorm (Root Mean Square Normalization)","sidebar_label":"RMSNorm \u5747\u65b9\u6839\u5f52\u4e00\u5316","date":"2025-12-07T00:00:00.000Z","last_update":{"date":"2025-12-07T00:00:00.000Z"},"tags":["transformer","normalization","rmsnorm","layernorm","llama","llm"]},"sidebar":"aiSidebar","previous":{"title":"\u7edd\u5bf9\u4f4d\u7f6e\u7f16\u7801","permalink":"/yiwen-blog-website/docs/ai/architectures/transformer/positional-encoding"},"next":{"title":"RoPE \u65cb\u8f6c\u4f4d\u7f6e\u7f16\u7801","permalink":"/yiwen-blog-website/docs/ai/architectures/transformer/rope"}}');var l=a(74848),t=a(28453);const i={title:"RMSNorm (Root Mean Square Normalization)",sidebar_label:"RMSNorm \u5747\u65b9\u6839\u5f52\u4e00\u5316",date:new Date("2025-12-07T00:00:00.000Z"),last_update:{date:new Date("2025-12-07T00:00:00.000Z")},tags:["transformer","normalization","rmsnorm","layernorm","llama","llm"]},r="\u6280\u672f\u6587\u6863\uff1aRMSNorm (Root Mean Square Normalization)",m={},c=[{value:"1. \u6838\u5fc3\u533a\u522b\uff1a\u7b97\u4e0d\u7b97&quot;\u5747\u503c&quot;",id:"1-\u6838\u5fc3\u533a\u522b\u7b97\u4e0d\u7b97\u5747\u503c",level:2},{value:"LayerNorm (LN)",id:"layernorm-ln",level:3},{value:"RMSNorm",id:"rmsnorm",level:3},{value:"2. \u4e3a\u4ec0\u4e48\u73b0\u5728 RMSNorm \u66ff\u4ee3\u4e86 LayerNorm\uff1f",id:"2-\u4e3a\u4ec0\u4e48\u73b0\u5728-rmsnorm-\u66ff\u4ee3\u4e86-layernorm",level:2},{value:"A. \u8ba1\u7b97\u6548\u7387\u66f4\u9ad8 (Speed &amp; Efficiency)",id:"a-\u8ba1\u7b97\u6548\u7387\u66f4\u9ad8-speed--efficiency",level:3},{value:"B. \u6548\u679c\u5e76\u6ca1\u6709\u53d8\u5dee (Performance)",id:"b-\u6548\u679c\u5e76\u6ca1\u6709\u53d8\u5dee-performance",level:3},{value:"C. \u7b80\u5316\u53c2\u6570 (Simplification)",id:"c-\u7b80\u5316\u53c2\u6570-simplification",level:3},{value:"3. \u4ee3\u7801\u5bf9\u6bd4 (PyTorch)",id:"3-\u4ee3\u7801\u5bf9\u6bd4-pytorch",level:2},{value:"4. \u5b8c\u6574\u7684 RMSNorm \u5b9e\u73b0",id:"4-\u5b8c\u6574\u7684-rmsnorm-\u5b9e\u73b0",level:2},{value:"5. \u603b\u7ed3\u5bf9\u6bd4",id:"5-\u603b\u7ed3\u5bf9\u6bd4",level:2}];function h(s){const e={annotation:"annotation",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",math:"math",mfrac:"mfrac",mi:"mi",mn:"mn",mo:"mo",mover:"mover",mrow:"mrow",msqrt:"msqrt",msubsup:"msubsup",mtext:"mtext",ol:"ol",p:"p",path:"path",pre:"pre",semantics:"semantics",span:"span",strong:"strong",svg:"svg",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...s.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"\u6280\u672f\u6587\u6863rmsnorm-root-mean-square-normalization",children:"\u6280\u672f\u6587\u6863\uff1aRMSNorm (Root Mean Square Normalization)"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"RMSNorm (Root Mean Square Normalization)"})," \u53ef\u4ee5\u88ab\u89c6\u4e3a ",(0,l.jsx)(e.strong,{children:"LayerNorm (Layer Normalization)"}),' \u7684"\u7b80\u5316\u7248"\u6216"\u52a0\u901f\u7248"\u3002']}),"\n",(0,l.jsxs)(e.p,{children:["\u76ee\u524d\u50cf LLaMA\u3001PaLM\u3001Gopher \u7b49\u4e3b\u6d41\u5927\u6a21\u578b\u7eb7\u7eb7\u7528 RMSNorm \u53d6\u4ee3 LayerNorm\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u5728",(0,l.jsx)(e.strong,{children:"\u4fdd\u6301\u6a21\u578b\u6027\u80fd\uff08\u6548\u679c\uff09\u51e0\u4e4e\u4e0d\u53d8\u7684\u524d\u63d0\u4e0b\uff0c\u663e\u8457\u63d0\u5347\u8ba1\u7b97\u901f\u5ea6\u548c\u8bad\u7ec3\u7a33\u5b9a\u6027"}),"\u3002"]}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"1-\u6838\u5fc3\u533a\u522b\u7b97\u4e0d\u7b97\u5747\u503c",children:'1. \u6838\u5fc3\u533a\u522b\uff1a\u7b97\u4e0d\u7b97"\u5747\u503c"'}),"\n",(0,l.jsxs)(e.p,{children:["\u4e24\u8005\u6700\u5927\u7684\u533a\u522b\u5728\u4e8e\uff1a",(0,l.jsx)(e.strong,{children:'\u662f\u5426\u5bf9\u6570\u636e\u8fdb\u884c\u4e86"\u53bb\u4e2d\u5fc3\u5316"\uff08Mean Centering\uff09'}),"\u3002"]}),"\n",(0,l.jsx)(e.h3,{id:"layernorm-ln",children:"LayerNorm (LN)"}),"\n",(0,l.jsx)(e.p,{children:"\u4f20\u7edf\u7684 LayerNorm \u505a\u4e24\u4ef6\u4e8b\uff1a"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u53bb\u4e2d\u5fc3\u5316\uff08Re-centering\uff09\uff1a"})," \u7b97\u51fa\u8f93\u5165\u7684\u5747\u503c\uff0c\u7136\u540e\u51cf\u53bb\u5b83\uff08\u8ba9\u6570\u636e\u5747\u503c\u4e3a 0\uff09\u3002"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u7f29\u653e\uff08Re-scaling\uff09\uff1a"})," \u7b97\u51fa\u65b9\u5dee\uff0c\u9664\u4ee5\u6807\u51c6\u5dee\uff08\u8ba9\u6570\u636e\u65b9\u5dee\u4e3a 1\uff09\u3002"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u516c\u5f0f\uff1a"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsxs)(e.mrow,{children:[(0,l.jsxs)(e.mover,{accent:"true",children:[(0,l.jsx)(e.mi,{children:"x"}),(0,l.jsx)(e.mo,{children:"\u02c9"})]}),(0,l.jsx)(e.mo,{children:"="}),(0,l.jsxs)(e.mfrac,{children:[(0,l.jsxs)(e.mrow,{children:[(0,l.jsx)(e.mi,{children:"x"}),(0,l.jsx)(e.mo,{children:"\u2212"}),(0,l.jsx)(e.mi,{children:"\u03bc"})]}),(0,l.jsxs)(e.mrow,{children:[(0,l.jsx)(e.mi,{children:"\u03c3"}),(0,l.jsx)(e.mo,{children:"+"}),(0,l.jsx)(e.mi,{children:"\u03f5"})]})]}),(0,l.jsx)(e.mo,{children:"\u22c5"}),(0,l.jsx)(e.mi,{children:"\u03b3"}),(0,l.jsx)(e.mo,{children:"+"}),(0,l.jsx)(e.mi,{children:"\u03b2"})]}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\bar{x} = \\frac{x - \\mu}{\\sigma + \\epsilon} \\cdot \\gamma + \\beta"})]})})}),(0,l.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.5678em"}}),(0,l.jsx)(e.span,{className:"mord accent",children:(0,l.jsx)(e.span,{className:"vlist-t",children:(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsxs)(e.span,{className:"vlist",style:{height:"0.5678em"},children:[(0,l.jsxs)(e.span,{style:{top:"-3em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",children:"x"})]}),(0,l.jsxs)(e.span,{style:{top:"-3em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,l.jsx)(e.span,{className:"accent-body",style:{left:"-0.2222em"},children:(0,l.jsx)(e.span,{className:"mord",children:"\u02c9"})})]})]})})})}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,l.jsx)(e.span,{className:"mrel",children:"="}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"1.2578em",verticalAlign:"-0.4033em"}}),(0,l.jsxs)(e.span,{className:"mord",children:[(0,l.jsx)(e.span,{className:"mopen nulldelimiter"}),(0,l.jsx)(e.span,{className:"mfrac",children:(0,l.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(e.span,{className:"vlist-r",children:[(0,l.jsxs)(e.span,{className:"vlist",style:{height:"0.8544em"},children:[(0,l.jsxs)(e.span,{style:{top:"-2.655em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsxs)(e.span,{className:"mord mtight",children:[(0,l.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.03588em"},children:"\u03c3"}),(0,l.jsx)(e.span,{className:"mbin mtight",children:"+"}),(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"\u03f5"})]})})]}),(0,l.jsxs)(e.span,{style:{top:"-3.23em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,l.jsx)(e.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,l.jsxs)(e.span,{style:{top:"-3.4461em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsxs)(e.span,{className:"mord mtight",children:[(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"x"}),(0,l.jsx)(e.span,{className:"mbin mtight",children:"\u2212"}),(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"\u03bc"})]})})]})]}),(0,l.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.4033em"},children:(0,l.jsx)(e.span,{})})})]})}),(0,l.jsx)(e.span,{className:"mclose nulldelimiter"})]}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,l.jsx)(e.span,{className:"mbin",children:"\u22c5"}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.7778em",verticalAlign:"-0.1944em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.05556em"},children:"\u03b3"}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,l.jsx)(e.span,{className:"mbin",children:"+"}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.05278em"},children:"\u03b2"})]})]})]})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsxs)(e.em,{children:["(\u5176\u4e2d ",(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsx)(e.mrow,{children:(0,l.jsx)(e.mi,{children:"\u03bc"})}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\mu"})]})})}),(0,l.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",children:"\u03bc"})]})})]})," \u662f\u5747\u503c\uff0c",(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsx)(e.mrow,{children:(0,l.jsx)(e.mi,{children:"\u03c3"})}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\sigma"})]})})}),(0,l.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.4306em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"\u03c3"})]})})]})," \u662f\u6807\u51c6\u5dee)"]})}),"\n",(0,l.jsx)(e.h3,{id:"rmsnorm",children:"RMSNorm"}),"\n",(0,l.jsx)(e.p,{children:'RMSNorm \u8ba4\u4e3a"\u53bb\u4e2d\u5fc3\u5316"\u8fd9\u4e00\u6b65\u662f\u591a\u4f59\u7684\uff0c\u5b83\u53ea\u505a\u4e00\u4ef6\u4e8b\uff1a'}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u7f29\u653e\uff08Re-scaling\uff09\uff1a"})," \u76f4\u63a5\u6839\u636e\u8f93\u5165\u7684\u5747\u65b9\u6839\uff08RMS\uff09\u8fdb\u884c\u7f29\u653e\u3002"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u516c\u5f0f\uff1a"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsxs)(e.mrow,{children:[(0,l.jsxs)(e.mover,{accent:"true",children:[(0,l.jsx)(e.mi,{children:"x"}),(0,l.jsx)(e.mo,{children:"\u02c9"})]}),(0,l.jsx)(e.mo,{children:"="}),(0,l.jsxs)(e.mfrac,{children:[(0,l.jsx)(e.mi,{children:"x"}),(0,l.jsxs)(e.mrow,{children:[(0,l.jsx)(e.mtext,{children:"RMS"}),(0,l.jsx)(e.mo,{stretchy:"false",children:"("}),(0,l.jsx)(e.mi,{children:"x"}),(0,l.jsx)(e.mo,{stretchy:"false",children:")"}),(0,l.jsx)(e.mo,{children:"+"}),(0,l.jsx)(e.mi,{children:"\u03f5"})]})]}),(0,l.jsx)(e.mo,{children:"\u22c5"}),(0,l.jsx)(e.mi,{children:"\u03b3"})]}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\bar{x} = \\frac{x}{\\text{RMS}(x) + \\epsilon} \\cdot \\gamma"})]})})}),(0,l.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.5678em"}}),(0,l.jsx)(e.span,{className:"mord accent",children:(0,l.jsx)(e.span,{className:"vlist-t",children:(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsxs)(e.span,{className:"vlist",style:{height:"0.5678em"},children:[(0,l.jsxs)(e.span,{style:{top:"-3em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",children:"x"})]}),(0,l.jsxs)(e.span,{style:{top:"-3em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,l.jsx)(e.span,{className:"accent-body",style:{left:"-0.2222em"},children:(0,l.jsx)(e.span,{className:"mord",children:"\u02c9"})})]})]})})})}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,l.jsx)(e.span,{className:"mrel",children:"="}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"1.2154em",verticalAlign:"-0.52em"}}),(0,l.jsxs)(e.span,{className:"mord",children:[(0,l.jsx)(e.span,{className:"mopen nulldelimiter"}),(0,l.jsx)(e.span,{className:"mfrac",children:(0,l.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(e.span,{className:"vlist-r",children:[(0,l.jsxs)(e.span,{className:"vlist",style:{height:"0.6954em"},children:[(0,l.jsxs)(e.span,{style:{top:"-2.655em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsxs)(e.span,{className:"mord mtight",children:[(0,l.jsx)(e.span,{className:"mord text mtight",children:(0,l.jsx)(e.span,{className:"mord mtight",children:"RMS"})}),(0,l.jsx)(e.span,{className:"mopen mtight",children:"("}),(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"x"}),(0,l.jsx)(e.span,{className:"mclose mtight",children:")"}),(0,l.jsx)(e.span,{className:"mbin mtight",children:"+"}),(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"\u03f5"})]})})]}),(0,l.jsxs)(e.span,{style:{top:"-3.23em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,l.jsx)(e.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,l.jsxs)(e.span,{style:{top:"-3.394em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(e.span,{className:"mord mtight",children:(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"x"})})})]})]}),(0,l.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.52em"},children:(0,l.jsx)(e.span,{})})})]})}),(0,l.jsx)(e.span,{className:"mclose nulldelimiter"})]}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,l.jsx)(e.span,{className:"mbin",children:"\u22c5"}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.05556em"},children:"\u03b3"})]})]})]})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsxs)(e.em,{children:["(\u5176\u4e2d ",(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsxs)(e.mrow,{children:[(0,l.jsx)(e.mtext,{children:"RMS"}),(0,l.jsx)(e.mo,{stretchy:"false",children:"("}),(0,l.jsx)(e.mi,{children:"x"}),(0,l.jsx)(e.mo,{stretchy:"false",children:")"}),(0,l.jsx)(e.mo,{children:"="}),(0,l.jsx)(e.msqrt,{children:(0,l.jsxs)(e.mrow,{children:[(0,l.jsxs)(e.mfrac,{children:[(0,l.jsx)(e.mn,{children:"1"}),(0,l.jsx)(e.mi,{children:"n"})]}),(0,l.jsx)(e.mo,{children:"\u2211"}),(0,l.jsxs)(e.msubsup,{children:[(0,l.jsx)(e.mi,{children:"x"}),(0,l.jsx)(e.mi,{children:"i"}),(0,l.jsx)(e.mn,{children:"2"})]})]})})]}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\text{RMS}(x) = \\sqrt{\\frac{1}{n} \\sum x_i^2}"})]})})}),(0,l.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,l.jsx)(e.span,{className:"mord text",children:(0,l.jsx)(e.span,{className:"mord",children:"RMS"})}),(0,l.jsx)(e.span,{className:"mopen",children:"("}),(0,l.jsx)(e.span,{className:"mord mathnormal",children:"x"}),(0,l.jsx)(e.span,{className:"mclose",children:")"}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,l.jsx)(e.span,{className:"mrel",children:"="}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"1.84em",verticalAlign:"-0.6049em"}}),(0,l.jsx)(e.span,{className:"mord sqrt",children:(0,l.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(e.span,{className:"vlist-r",children:[(0,l.jsxs)(e.span,{className:"vlist",style:{height:"1.2351em"},children:[(0,l.jsxs)(e.span,{className:"svg-align",style:{top:"-3.8em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3.8em"}}),(0,l.jsxs)(e.span,{className:"mord",style:{paddingLeft:"1em"},children:[(0,l.jsxs)(e.span,{className:"mord",children:[(0,l.jsx)(e.span,{className:"mopen nulldelimiter"}),(0,l.jsx)(e.span,{className:"mfrac",children:(0,l.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(e.span,{className:"vlist-r",children:[(0,l.jsxs)(e.span,{className:"vlist",style:{height:"0.8451em"},children:[(0,l.jsxs)(e.span,{style:{top:"-2.655em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(e.span,{className:"mord mtight",children:(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"n"})})})]}),(0,l.jsxs)(e.span,{style:{top:"-3.23em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,l.jsx)(e.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,l.jsxs)(e.span,{style:{top:"-3.394em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(e.span,{className:"mord mtight",children:(0,l.jsx)(e.span,{className:"mord mtight",children:"1"})})})]})]}),(0,l.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.345em"},children:(0,l.jsx)(e.span,{})})})]})}),(0,l.jsx)(e.span,{className:"mclose nulldelimiter"})]}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,l.jsx)(e.span,{className:"mop op-symbol small-op",style:{position:"relative",top:"0em"},children:"\u2211"}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,l.jsxs)(e.span,{className:"mord",children:[(0,l.jsx)(e.span,{className:"mord mathnormal",children:"x"}),(0,l.jsx)(e.span,{className:"msupsub",children:(0,l.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(e.span,{className:"vlist-r",children:[(0,l.jsxs)(e.span,{className:"vlist",style:{height:"0.7959em"},children:[(0,l.jsxs)(e.span,{style:{top:"-2.4231em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]}),(0,l.jsxs)(e.span,{style:{top:"-3.0448em",marginRight:"0.05em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(e.span,{className:"mord mtight",children:"2"})})]})]}),(0,l.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.2769em"},children:(0,l.jsx)(e.span,{})})})]})})]})]})]}),(0,l.jsxs)(e.span,{style:{top:"-3.1951em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3.8em"}}),(0,l.jsx)(e.span,{className:"hide-tail",style:{minWidth:"1.02em",height:"1.88em"},children:(0,l.jsx)(e.svg,{xmlns:"http://www.w3.org/2000/svg",width:"400em",height:"1.88em",viewBox:"0 0 400000 1944",preserveAspectRatio:"xMinYMin slice",children:(0,l.jsx)(e.path,{d:"M983 90\nl0 -0\nc4,-6.7,10,-10,18,-10 H400000v40\nH1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7\ns-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744\nc-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30\nc26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722\nc56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5\nc53.7,-170.3,84.5,-266.8,92.5,-289.5z\nM1001 80h400000v40h-400000z"})})})]})]}),(0,l.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.6049em"},children:(0,l.jsx)(e.span,{})})})]})})]})]})]}),"\uff0c\u4e0d\u9700\u8981\u8ba1\u7b97\u5747\u503c ",(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsx)(e.mrow,{children:(0,l.jsx)(e.mi,{children:"\u03bc"})}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\mu"})]})})}),(0,l.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",children:"\u03bc"})]})})]}),")"]})}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"2-\u4e3a\u4ec0\u4e48\u73b0\u5728-rmsnorm-\u66ff\u4ee3\u4e86-layernorm",children:"2. \u4e3a\u4ec0\u4e48\u73b0\u5728 RMSNorm \u66ff\u4ee3\u4e86 LayerNorm\uff1f"}),"\n",(0,l.jsx)(e.p,{children:"\u5728\u5927\u6a21\u578b\u65f6\u4ee3\uff0c\u8fd9\u4e2a\u66ff\u4ee3\u4e3b\u8981\u7531\u4ee5\u4e0b\u4e09\u4e2a\u539f\u56e0\u9a71\u52a8\uff1a"}),"\n",(0,l.jsx)(e.h3,{id:"a-\u8ba1\u7b97\u6548\u7387\u66f4\u9ad8-speed--efficiency",children:"A. \u8ba1\u7b97\u6548\u7387\u66f4\u9ad8 (Speed & Efficiency)"}),"\n",(0,l.jsx)(e.p,{children:"\u8fd9\u662f\u6700\u4e3b\u8981\u7684\u539f\u56e0\u3002"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5c11\u7b97\u4e00\u6b65\uff1a"})," LayerNorm \u9700\u8981\u5148\u7b97\u5747\u503c\uff0c\u518d\u51cf\u5747\u503c\uff0c\u518d\u7b97\u65b9\u5dee\u3002RMSNorm \u76f4\u63a5\u7b97\u5747\u65b9\u6839\u3002\u867d\u7136\u5355\u6b21\u8ba1\u7b97\u770b\u8d77\u6765\u7701\u5f97\u4e0d\u591a\uff0c\u4f46\u5728\u4e00\u4e2a\u51e0\u767e\u4ebf\u53c2\u6570\u3001\u51e0\u5341\u5c42\u6df1\u7684\u5927\u6a21\u578b\u4e2d\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u8981\u91cd\u590d\u6570\u5341\u4ebf\u6b21\uff0c\u7d2f\u8ba1\u8282\u7701\u7684\u8ba1\u7b97\u65f6\u95f4\uff08Wall-clock time\uff09\u975e\u5e38\u53ef\u89c2\u3002"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u8282\u7701\u663e\u5b58\u5e26\u5bbd\uff1a"})," \u73b0\u4ee3 GPU \u8bad\u7ec3\u901a\u5e38\u53d7\u9650\u4e8e\u663e\u5b58\u5e26\u5bbd\uff08Memory Bandwidth\uff09\u800c\u4e0d\u662f\u8ba1\u7b97\u80fd\u529b\u3002RMSNorm \u7684\u8ba1\u7b97\u8fc7\u7a0b\u66f4\u7b80\u5355\uff0c\u51cf\u5c11\u4e86\u6570\u636e\u7684\u642c\u8fd0\u548c\u8bfb\u5199\u3002"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5b9e\u6d4b\u6570\u636e\uff1a"})," \u7814\u7a76\u8868\u660e\uff0c\u5728\u67d0\u4e9b Transformer \u6a21\u578b\u4e2d\uff0c\u4f7f\u7528 RMSNorm \u53ef\u4ee5\u5e26\u6765 ",(0,l.jsx)(e.strong,{children:"10% ~ 40%"})," \u7684\u63a8\u7406\u52a0\u901f\u3002"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"b-\u6548\u679c\u5e76\u6ca1\u6709\u53d8\u5dee-performance",children:"B. \u6548\u679c\u5e76\u6ca1\u6709\u53d8\u5dee (Performance)"}),"\n",(0,l.jsx)(e.p,{children:"\u8fd9\u4e00\u6761\u662f\u66ff\u4ee3\u7684\u524d\u63d0\u3002"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["Geoffrey Hinton \u7b49\u4eba\u7684\u7814\u7a76\u4ee5\u53ca\u540e\u7eed\u7684\u5927\u91cf\u5b9e\u9a8c\u53d1\u73b0\uff0cLayerNorm \u8d77\u4f5c\u7528\u7684\u5173\u952e\u5728\u4e8e**\u7f29\u653e\uff08Scaling\uff09",(0,l.jsx)(e.strong,{children:"\u7684\u4e0d\u53d8\u6027\uff0c\u800c\u4e0d\u662f"}),"\u5e73\u79fb\uff08Shifting/Centering\uff09**\u7684\u4e0d\u53d8\u6027\u3002"]}),"\n",(0,l.jsxs)(e.li,{children:["\u4e5f\u5c31\u662f\u8bf4\uff0c",(0,l.jsx)(e.strong,{children:'"\u51cf\u53bb\u5747\u503c"\u8fd9\u4e00\u6b65\u5bf9\u4e8e\u6df1\u5c42\u7f51\u7edc\u7684\u8bad\u7ec3\u7a33\u5b9a\u6027\u8d21\u732e\u5f88\u5c0f'}),"\u3002\u65e2\u7136\u53bb\u6389\u4e86\u4e5f\u4e0d\u5f71\u54cd\u7cbe\u5ea6\uff0c\u4e3a\u4e86\u901f\u5ea6\u81ea\u7136\u5c31\u53bb\u6389\u4e86\u3002"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"c-\u7b80\u5316\u53c2\u6570-simplification",children:"C. \u7b80\u5316\u53c2\u6570 (Simplification)"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u4f20\u7edf\u7684 LayerNorm \u901a\u5e38\u6709\u4e24\u4e2a\u53ef\u5b66\u4e60\u53c2\u6570\uff1a\u7f29\u653e\u56e0\u5b50 ",(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsx)(e.mrow,{children:(0,l.jsx)(e.mi,{children:"\u03b3"})}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\gamma"})]})})}),(0,l.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.05556em"},children:"\u03b3"})]})})]})," (gain) \u548c \u5e73\u79fb\u56e0\u5b50 ",(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsx)(e.mrow,{children:(0,l.jsx)(e.mi,{children:"\u03b2"})}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\beta"})]})})}),(0,l.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.05278em"},children:"\u03b2"})]})})]})," (bias)\u3002"]}),"\n",(0,l.jsxs)(e.li,{children:["\u4e3b\u6d41\u7684 RMSNorm \u5b9e\u73b0\uff08\u5982 LLaMA \u6240\u7528\u7684\uff09\u901a\u5e38",(0,l.jsxs)(e.strong,{children:["\u53bb\u6389\u4e86 Bias (",(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsx)(e.mrow,{children:(0,l.jsx)(e.mi,{children:"\u03b2"})}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\beta"})]})})}),(0,l.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.05278em"},children:"\u03b2"})]})})]}),") \u9879"]}),"\uff0c\u53ea\u4fdd\u7559\u7f29\u653e\u56e0\u5b50 ",(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsx)(e.mrow,{children:(0,l.jsx)(e.mi,{children:"\u03b3"})}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\gamma"})]})})}),(0,l.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.05556em"},children:"\u03b3"})]})})]}),"\u3002\u8fd9\u8fdb\u4e00\u6b65\u51cf\u5c11\u4e86\u53c2\u6570\u91cf\u548c\u5185\u5b58\u5360\u7528\uff0c\u4e14\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u80fd\u63d0\u5347\u6a21\u578b\u7684\u6570\u503c\u7a33\u5b9a\u6027\u3002"]}),"\n"]}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"3-\u4ee3\u7801\u5bf9\u6bd4-pytorch",children:"3. \u4ee3\u7801\u5bf9\u6bd4 (PyTorch)"}),"\n",(0,l.jsx)(e.p,{children:"\u770b\u4ee3\u7801\u4f1a\u66f4\u76f4\u89c2\uff0c\u4f60\u4f1a\u53d1\u73b0 RMSNorm \u5c11\u4e86\u4e00\u5927\u5757\u903b\u8f91\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-python",children:"import torch\n\n# === LayerNorm ===\n# 1. \u8ba1\u7b97\u5747\u503c (Mean)\nmean = x.mean(dim=-1, keepdim=True)\n# 2. \u8ba1\u7b97\u65b9\u5dee (Variance)\nvar = x.var(dim=-1, keepdim=True, unbiased=False)\n# 3. \u5f52\u4e00\u5316 (\u51cf\u5747\u503c\uff0c\u9664\u6807\u51c6\u5dee)\nx_norm = (x - mean) / torch.sqrt(var + epsilon)\n# 4. \u4eff\u5c04\u53d8\u6362 (\u4e58 gamma \u52a0 beta)\noutput = x_norm * gamma + beta\n\n\n# === RMSNorm ===\n# 1. \u4e0d\u7b97\u5747\u503c\uff0c\u76f4\u63a5\u7b97\u5747\u65b9\u6839 (RMS)\nrms = torch.sqrt(x.pow(2).mean(dim=-1, keepdim=True) + epsilon)\n# 2. \u5f52\u4e00\u5316 (\u53ea\u9664\u4ee5 RMS)\nx_norm = x / rms\n# 3. \u4eff\u5c04\u53d8\u6362 (\u901a\u5e38\u53ea\u6709 gamma\uff0c\u6ca1\u6709 beta)\noutput = x_norm * gamma\n"})}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"4-\u5b8c\u6574\u7684-rmsnorm-\u5b9e\u73b0",children:"4. \u5b8c\u6574\u7684 RMSNorm \u5b9e\u73b0"}),"\n",(0,l.jsx)(e.p,{children:"\u4ee5\u4e0b\u662f\u4e00\u4e2a\u53ef\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u7684 RMSNorm \u6a21\u5757\u5b9e\u73b0\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-python",children:'import torch\nimport torch.nn as nn\n\nclass RMSNorm(nn.Module):\n    """\n    Root Mean Square Layer Normalization.\n\n    \u8bba\u6587: https://arxiv.org/abs/1910.07467\n\n    Args:\n        dim (int): \u8f93\u5165\u7684\u6700\u540e\u4e00\u4e2a\u7ef4\u5ea6\u5927\u5c0f\n        eps (float): \u9632\u6b62\u9664\u96f6\u7684\u5c0f\u5e38\u6570\uff0c\u9ed8\u8ba4 1e-6\n    """\n    def __init__(self, dim: int, eps: float = 1e-6):\n        super().__init__()\n        self.eps = eps\n        # \u53ef\u5b66\u4e60\u7684\u7f29\u653e\u53c2\u6570\uff0c\u521d\u59cb\u5316\u4e3a 1\n        self.weight = nn.Parameter(torch.ones(dim))\n\n    def _norm(self, x: torch.Tensor) -> torch.Tensor:\n        """\u8ba1\u7b97 RMS \u5f52\u4e00\u5316"""\n        # x.pow(2).mean(-1, keepdim=True): \u8ba1\u7b97\u6bcf\u4e2a\u6837\u672c\u7684\u5747\u65b9\u503c\n        # rsqrt: \u8ba1\u7b97\u5e73\u65b9\u6839\u7684\u5012\u6570 (1/sqrt(x))\uff0c\u6bd4 1/torch.sqrt(x) \u66f4\u5feb\n        return x * torch.rsqrt(x.pow(2).mean(-1, keepdim=True) + self.eps)\n\n    def forward(self, x: torch.Tensor) -> torch.Tensor:\n        # \u5148\u8f6c\u4e3a float32 \u8ba1\u7b97\u4ee5\u4fdd\u8bc1\u6570\u503c\u7cbe\u5ea6\uff0c\u518d\u8f6c\u56de\u539f\u59cb dtype\n        output = self._norm(x.float()).type_as(x)\n        return output * self.weight\n\n\n# --- \u4f7f\u7528\u793a\u4f8b ---\nif __name__ == \'__main__\':\n    batch_size, seq_len, d_model = 2, 128, 4096\n\n    # \u521d\u59cb\u5316 RMSNorm\n    rms_norm = RMSNorm(dim=d_model)\n\n    # \u521b\u5efa\u8f93\u5165\n    x = torch.randn(batch_size, seq_len, d_model)\n\n    # \u524d\u5411\u4f20\u64ad\n    output = rms_norm(x)\n\n    print(f"Input shape: {x.shape}")\n    print(f"Output shape: {output.shape}")\n    print(f"Input mean: {x.mean().item():.4f}, std: {x.std().item():.4f}")\n    print(f"Output mean: {output.mean().item():.4f}, std: {output.std().item():.4f}")\n'})}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"5-\u603b\u7ed3\u5bf9\u6bd4",children:"5. \u603b\u7ed3\u5bf9\u6bd4"}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{style:{textAlign:"left"},children:"\u7279\u6027"}),(0,l.jsx)(e.th,{style:{textAlign:"left"},children:"LayerNorm"}),(0,l.jsx)(e.th,{style:{textAlign:"left"},children:"RMSNorm"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:(0,l.jsx)(e.strong,{children:"\u64cd\u4f5c"})}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"\u51cf\u5747\u503c + \u9664\u6807\u51c6\u5dee"}),(0,l.jsxs)(e.td,{style:{textAlign:"left"},children:[(0,l.jsx)(e.strong,{children:"\u4ec5"}),"\u9664\u4ee5\u5747\u65b9\u6839"]})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:(0,l.jsx)(e.strong,{children:"\u8ba1\u7b97\u91cf"})}),(0,l.jsxs)(e.td,{style:{textAlign:"left"},children:["\u8f83\u9ad8 (\u8ba1\u7b97 ",(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsx)(e.mrow,{children:(0,l.jsx)(e.mi,{children:"\u03bc"})}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\mu"})]})})}),(0,l.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",children:"\u03bc"})]})})]})," \u548c ",(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsx)(e.mrow,{children:(0,l.jsx)(e.mi,{children:"\u03c3"})}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\sigma"})]})})}),(0,l.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.4306em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"\u03c3"})]})})]}),")"]}),(0,l.jsxs)(e.td,{style:{textAlign:"left"},children:[(0,l.jsx)(e.strong,{children:"\u8f83\u4f4e"})," (\u7701\u53bb\u4e86 ",(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsx)(e.mrow,{children:(0,l.jsx)(e.mi,{children:"\u03bc"})}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\mu"})]})})}),(0,l.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",children:"\u03bc"})]})})]}),")"]})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:(0,l.jsx)(e.strong,{children:"\u53c2\u6570"})}),(0,l.jsxs)(e.td,{style:{textAlign:"left"},children:["\u7f29\u653e ",(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsx)(e.mrow,{children:(0,l.jsx)(e.mi,{children:"\u03b3"})}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\gamma"})]})})}),(0,l.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.05556em"},children:"\u03b3"})]})})]})," + \u504f\u7f6e ",(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsx)(e.mrow,{children:(0,l.jsx)(e.mi,{children:"\u03b2"})}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\beta"})]})})}),(0,l.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.05278em"},children:"\u03b2"})]})})]})]}),(0,l.jsxs)(e.td,{style:{textAlign:"left"},children:["\u901a\u5e38\u53ea\u6709\u7f29\u653e ",(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsx)(e.mrow,{children:(0,l.jsx)(e.mi,{children:"\u03b3"})}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\gamma"})]})})}),(0,l.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.05556em"},children:"\u03b3"})]})})]})]})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:(0,l.jsx)(e.strong,{children:"\u4e3b\u8981\u4f18\u52bf"})}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"\u7406\u8bba\u5b8c\u5907\uff0c\u65e9\u671f\u6807\u51c6"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:(0,l.jsx)(e.strong,{children:"\u901f\u5ea6\u5feb\uff0c\u663e\u5b58\u53cb\u597d"})})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:(0,l.jsx)(e.strong,{children:"\u4ee3\u8868\u6a21\u578b"})}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"BERT, GPT-2, RoBERTa"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:(0,l.jsx)(e.strong,{children:"LLaMA, T5, Gopher"})})]})]})]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u4e00\u53e5\u8bdd\u603b\u7ed3\uff1a"}),' RMSNorm \u662f LayerNorm \u7684"\u7701\u6d41\u7248"\uff0c\u5b83\u53bb\u6389\u4e86\u5bf9\u5927\u6a21\u578b\u8bad\u7ec3\u5e2e\u52a9\u4e0d\u5927\u7684"\u51cf\u5747\u503c"\u64cd\u4f5c\uff0c\u6362\u6765\u4e86\u66f4\u5feb\u7684\u901f\u5ea6\u548c\u66f4\u7b80\u5355\u7684\u5b9e\u73b0\uff0c\u662f\u76ee\u524d\u5927\u6a21\u578b\u8ffd\u6c42\u6781\u81f4\u6548\u7387\u7684\u5fc5\u7136\u9009\u62e9\u3002']})]})}function x(s={}){const{wrapper:e}={...(0,t.R)(),...s.components};return e?(0,l.jsx)(e,{...s,children:(0,l.jsx)(h,{...s})}):h(s)}}}]);