"use strict";(globalThis.webpackChunkyiwen_blog_website=globalThis.webpackChunkyiwen_blog_website||[]).push([[4058],{26885(e,t,l){l.r(t),l.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>j,frontMatter:()=>d,metadata:()=>n,toc:()=>x});const n=JSON.parse('{"id":"ai/nlp/chatml-special-tokens","title":"ChatML \u683c\u5f0f\u4e0e\u5e38\u7528\u7279\u6b8a\u6807\u8bb0","description":"\u4ec0\u4e48\u662f ChatML","source":"@site/docs/ai/nlp/chatml-special-tokens.md","sourceDirName":"ai/nlp","slug":"/ai/nlp/chatml-special-tokens","permalink":"/yiwen-blog-website/docs/ai/nlp/chatml-special-tokens","draft":false,"unlisted":false,"editUrl":"https://github.com/Hao-yiwen/yiwen-blog-website/tree/master/docs/ai/nlp/chatml-special-tokens.md","tags":[{"inline":true,"label":"ChatML","permalink":"/yiwen-blog-website/docs/tags/chat-ml"},{"inline":true,"label":"Special Tokens","permalink":"/yiwen-blog-website/docs/tags/special-tokens"},{"inline":true,"label":"LLM","permalink":"/yiwen-blog-website/docs/tags/llm"},{"inline":true,"label":"SFT","permalink":"/yiwen-blog-website/docs/tags/sft"}],"version":"current","lastUpdatedAt":1765065600000,"frontMatter":{"title":"ChatML \u683c\u5f0f\u4e0e\u5e38\u7528\u7279\u6b8a\u6807\u8bb0","sidebar_label":"ChatML \u7279\u6b8a\u6807\u8bb0","date":"2025-12-07T00:00:00.000Z","last_update":{"date":"2025-12-07T00:00:00.000Z"},"tags":["ChatML","Special Tokens","LLM","SFT"]},"sidebar":"aiSidebar","previous":{"title":"\u9690\u9a6c\u5c14\u53ef\u592b\u6a21\u578b","permalink":"/yiwen-blog-website/docs/ai/nlp/hmm"},"next":{"title":"LLM \u6d8c\u73b0\u4e0e\u987f\u609f","permalink":"/yiwen-blog-website/docs/ai/nlp/llm-emergence-grokking"}}');var s=l(74848),i=l(28453);const d={title:"ChatML \u683c\u5f0f\u4e0e\u5e38\u7528\u7279\u6b8a\u6807\u8bb0",sidebar_label:"ChatML \u7279\u6b8a\u6807\u8bb0",date:new Date("2025-12-07T00:00:00.000Z"),last_update:{date:new Date("2025-12-07T00:00:00.000Z")},tags:["ChatML","Special Tokens","LLM","SFT"]},r="ChatML \u683c\u5f0f\u4e0e\u5e38\u7528\u7279\u6b8a\u6807\u8bb0",c={},x=[{value:"\u4ec0\u4e48\u662f ChatML",id:"\u4ec0\u4e48\u662f-chatml",level:2},{value:"\u57fa\u672c\u7ed3\u6784",id:"\u57fa\u672c\u7ed3\u6784",level:3},{value:"\u7ed3\u6784\u62c6\u89e3",id:"\u7ed3\u6784\u62c6\u89e3",level:3},{value:"\u5e38\u7528\u7279\u6b8a\u6807\u8bb0 (Special Tokens)",id:"\u5e38\u7528\u7279\u6b8a\u6807\u8bb0-special-tokens",level:2},{value:"1. \u901a\u7528\u7279\u6b8a\u6807\u8bb0",id:"1-\u901a\u7528\u7279\u6b8a\u6807\u8bb0",level:3},{value:"2. ChatML \u7279\u6b8a\u6807\u8bb0",id:"2-chatml-\u7279\u6b8a\u6807\u8bb0",level:3},{value:"3. \u4e0d\u540c\u6a21\u578b\u7684\u7279\u6b8a\u6807\u8bb0\u5bf9\u6bd4",id:"3-\u4e0d\u540c\u6a21\u578b\u7684\u7279\u6b8a\u6807\u8bb0\u5bf9\u6bd4",level:3},{value:"Qwen / Qwen2 \u7cfb\u5217",id:"qwen--qwen2-\u7cfb\u5217",level:4},{value:"LLaMA 2 / LLaMA 3 \u7cfb\u5217",id:"llama-2--llama-3-\u7cfb\u5217",level:4},{value:"Yi \u7cfb\u5217",id:"yi-\u7cfb\u5217",level:4},{value:"Mistral / Mixtral \u7cfb\u5217",id:"mistral--mixtral-\u7cfb\u5217",level:4},{value:"\u7279\u6b8a\u6807\u8bb0\u6c47\u603b\u8868",id:"\u7279\u6b8a\u6807\u8bb0\u6c47\u603b\u8868",level:2},{value:"SFT \u8bad\u7ec3\u4e2d\u7684 Loss Mask",id:"sft-\u8bad\u7ec3\u4e2d\u7684-loss-mask",level:2},{value:"\u4ee3\u7801\u793a\u4f8b",id:"\u4ee3\u7801\u793a\u4f8b",level:2},{value:"\u4f7f\u7528 HuggingFace Tokenizer",id:"\u4f7f\u7528-huggingface-tokenizer",level:3},{value:"\u8f93\u51fa\u793a\u4f8b",id:"\u8f93\u51fa\u793a\u4f8b",level:3},{value:"\u751f\u6210\u65f6\u6dfb\u52a0 Prompt",id:"\u751f\u6210\u65f6\u6dfb\u52a0-prompt",level:3},{value:"\u4e3a\u4ec0\u4e48\u9700\u8981\u7279\u6b8a\u6807\u8bb0\uff1f",id:"\u4e3a\u4ec0\u4e48\u9700\u8981\u7279\u6b8a\u6807\u8bb0",level:2},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:2}];function h(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"chatml-\u683c\u5f0f\u4e0e\u5e38\u7528\u7279\u6b8a\u6807\u8bb0",children:"ChatML \u683c\u5f0f\u4e0e\u5e38\u7528\u7279\u6b8a\u6807\u8bb0"})}),"\n",(0,s.jsx)(t.h2,{id:"\u4ec0\u4e48\u662f-chatml",children:"\u4ec0\u4e48\u662f ChatML"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"ChatML (Chat Markup Language)"})," \u662f\u4e00\u79cd\u5c06\u591a\u8f6e\u5bf9\u8bdd\u5e8f\u5217\u5316\u4e3a\u6a21\u578b\u8f93\u5165\u7684\u6807\u51c6\u683c\u5f0f\u3002\u6700\u65e9\u7531 OpenAI \u63d0\u51fa\uff0c\u73b0\u5728\u88ab Qwen\u3001Yi\u3001DeepSeek \u7b49\u4f17\u591a\u6a21\u578b\u5e7f\u6cdb\u91c7\u7528\u3002"]}),"\n",(0,s.jsxs)(t.p,{children:["\u6838\u5fc3\u601d\u60f3\uff1a",(0,s.jsx)(t.strong,{children:"\u628a\u5bf9\u8bdd\u53d8\u6210\u4e00\u79cd\u7c7b\u4f3c HTML/XML \u7684\u6587\u6863\u7ed3\u6784"}),"\uff0c\u4f7f\u7528\u7279\u6b8a\u6807\u8bb0\u6765\u533a\u5206\u4e0d\u540c\u89d2\u8272\u7684\u53d1\u8a00\u3002"]}),"\n",(0,s.jsx)(t.h3,{id:"\u57fa\u672c\u7ed3\u6784",children:"\u57fa\u672c\u7ed3\u6784"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"<|im_start|>system\n\u4f60\u662f\u4e00\u4e2a\u4e13\u4e1a\u7684AI\u52a9\u624b\u3002<|im_end|>\n<|im_start|>user\n\u4f60\u597d\uff01<|im_end|>\n<|im_start|>assistant\n\u4f60\u597d\uff01\u6709\u4ec0\u4e48\u53ef\u4ee5\u5e2e\u52a9\u4f60\u7684\u5417\uff1f<|im_end|>\n"})}),"\n",(0,s.jsx)(t.h3,{id:"\u7ed3\u6784\u62c6\u89e3",children:"\u7ed3\u6784\u62c6\u89e3"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u7ec4\u6210\u90e8\u5206"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u6587\u672c\u5185\u5bb9"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u8bf4\u660e"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Header"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|im_start|>system\\n"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["\u58f0\u660e\u63a5\u4e0b\u6765\u662f",(0,s.jsx)(t.strong,{children:"\u7cfb\u7edf\u6307\u4ee4"})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Content"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"\u4f60\u662f\u4e00\u4e2a\u4e13\u4e1a\u7684AI\u52a9\u624b\u3002"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u7cfb\u7edf\u63d0\u793a\u8bcd (System Prompt)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Footer"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|im_end|>\\n"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u7cfb\u7edf\u6307\u4ee4\u7ed3\u675f"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Header"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|im_start|>user\\n"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["\u58f0\u660e\u63a5\u4e0b\u6765\u662f",(0,s.jsx)(t.strong,{children:"\u7528\u6237\u53d1\u8a00"})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Content"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"\u4f60\u597d\uff01"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u7528\u6237\u7684\u95ee\u9898"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Footer"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|im_end|>\\n"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u7528\u6237\u53d1\u8a00\u7ed3\u675f"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Header"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|im_start|>assistant\\n"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["\u58f0\u660e\u63a5\u4e0b\u6765\u662f",(0,s.jsx)(t.strong,{children:"AI\u53d1\u8a00"})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Content"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"\u4f60\u597d\uff01\u6709\u4ec0\u4e48..."})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"AI \u7684\u56de\u7b54\uff08SFT \u8bad\u7ec3\u76ee\u6807\uff09"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Footer"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|im_end|>\\n"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"AI \u56de\u7b54\u7ed3\u675f (EOS)"})]})]})]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"\u5e38\u7528\u7279\u6b8a\u6807\u8bb0-special-tokens",children:"\u5e38\u7528\u7279\u6b8a\u6807\u8bb0 (Special Tokens)"}),"\n",(0,s.jsx)(t.h3,{id:"1-\u901a\u7528\u7279\u6b8a\u6807\u8bb0",children:"1. \u901a\u7528\u7279\u6b8a\u6807\u8bb0"}),"\n",(0,s.jsx)(t.p,{children:"\u8fd9\u4e9b\u6807\u8bb0\u5728\u51e0\u4e4e\u6240\u6709 LLM \u4e2d\u90fd\u5b58\u5728\uff1a"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u6807\u8bb0"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u540d\u79f0"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u4f5c\u7528"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u793a\u4f8b"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.code,{children:"<bos>"})," / ",(0,s.jsx)(t.code,{children:"<s>"})]}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Begin of Sequence"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u5e8f\u5217\u5f00\u59cb\u6807\u8bb0"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u8868\u793a\u4e00\u6bb5\u6587\u672c\u7684\u8d77\u59cb"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.code,{children:"<eos>"})," / ",(0,s.jsx)(t.code,{children:"</s>"})]}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"End of Sequence"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u5e8f\u5217\u7ed3\u675f\u6807\u8bb0"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u544a\u8bc9\u6a21\u578b\u505c\u6b62\u751f\u6210"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<pad>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Padding"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u586b\u5145\u6807\u8bb0"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u6279\u5904\u7406\u65f6\u5bf9\u9f50\u4e0d\u540c\u957f\u5ea6\u7684\u5e8f\u5217"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<unk>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Unknown"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u672a\u77e5\u6807\u8bb0"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u8868\u793a\u8bcd\u8868\u4e2d\u4e0d\u5b58\u5728\u7684 token"})]})]})]}),"\n",(0,s.jsx)(t.h3,{id:"2-chatml-\u7279\u6b8a\u6807\u8bb0",children:"2. ChatML \u7279\u6b8a\u6807\u8bb0"}),"\n",(0,s.jsx)(t.p,{children:"ChatML \u683c\u5f0f\u7684\u6838\u5fc3\u6807\u8bb0\uff1a"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u6807\u8bb0"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u542b\u4e49"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u7528\u9014"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|im_start|>"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.strong,{children:"I"}),"nstruction ",(0,s.jsx)(t.strong,{children:"M"}),"essage Start"]}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u6d88\u606f\u5f00\u59cb\uff0c\u540e\u63a5\u89d2\u8272\u540d"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|im_end|>"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.strong,{children:"I"}),"nstruction ",(0,s.jsx)(t.strong,{children:"M"}),"essage End"]}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u6d88\u606f\u7ed3\u675f\uff0c\u5145\u5f53 EOS"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"system"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u7cfb\u7edf\u89d2\u8272"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u8bbe\u5b9a AI \u7684\u884c\u4e3a\u548c\u80cc\u666f"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"user"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u7528\u6237\u89d2\u8272"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u7528\u6237\u7684\u8f93\u5165"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"assistant"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u52a9\u624b\u89d2\u8272"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"AI \u7684\u56de\u590d"})]})]})]}),"\n",(0,s.jsx)(t.h3,{id:"3-\u4e0d\u540c\u6a21\u578b\u7684\u7279\u6b8a\u6807\u8bb0\u5bf9\u6bd4",children:"3. \u4e0d\u540c\u6a21\u578b\u7684\u7279\u6b8a\u6807\u8bb0\u5bf9\u6bd4"}),"\n",(0,s.jsx)(t.h4,{id:"qwen--qwen2-\u7cfb\u5217",children:"Qwen / Qwen2 \u7cfb\u5217"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"<|im_start|>system\n\u4f60\u662f\u4e00\u4e2a\u6709\u5e2e\u52a9\u7684\u52a9\u624b\u3002<|im_end|>\n<|im_start|>user\n\u4eca\u5929\u5929\u6c14\u600e\u4e48\u6837\uff1f<|im_end|>\n<|im_start|>assistant\n"})}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u6807\u8bb0"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Token ID\uff08\u793a\u4f8b\uff09"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|im_start|>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"151644"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|im_end|>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"151645"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|endoftext|>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"151643"})]})]})]}),"\n",(0,s.jsx)(t.h4,{id:"llama-2--llama-3-\u7cfb\u5217",children:"LLaMA 2 / LLaMA 3 \u7cfb\u5217"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"LLaMA 2 \u683c\u5f0f\uff1a"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"<s>[INST] <<SYS>>\n\u4f60\u662f\u4e00\u4e2a\u6709\u5e2e\u52a9\u7684\u52a9\u624b\u3002\n<</SYS>>\n\n\u4eca\u5929\u5929\u6c14\u600e\u4e48\u6837\uff1f [/INST] \u4eca\u5929\u5929\u6c14\u6674\u6717\u3002</s>\n"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"LLaMA 3 \u683c\u5f0f\uff1a"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"<|begin_of_text|><|start_header_id|>system<|end_header_id|>\n\n\u4f60\u662f\u4e00\u4e2a\u6709\u5e2e\u52a9\u7684\u52a9\u624b\u3002<|eot_id|><|start_header_id|>user<|end_header_id|>\n\n\u4eca\u5929\u5929\u6c14\u600e\u4e48\u6837\uff1f<|eot_id|><|start_header_id|>assistant<|end_header_id|>\n"})}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u6807\u8bb0"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u4f5c\u7528"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|begin_of_text|>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u6587\u672c\u5f00\u59cb (BOS)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|end_of_text|>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u6587\u672c\u7ed3\u675f (EOS)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|start_header_id|>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u89d2\u8272\u6807\u8bc6\u5f00\u59cb"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|end_header_id|>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u89d2\u8272\u6807\u8bc6\u7ed3\u675f"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|eot_id|>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"End of Turn\uff0c\u8f6e\u6b21\u7ed3\u675f"})]})]})]}),"\n",(0,s.jsx)(t.h4,{id:"yi-\u7cfb\u5217",children:"Yi \u7cfb\u5217"}),"\n",(0,s.jsx)(t.p,{children:"Yi \u6a21\u578b\u91c7\u7528\u6807\u51c6 ChatML \u683c\u5f0f\uff1a"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"<|im_start|>system\n\u4f60\u662f\u4e00\u4e2a\u6709\u5e2e\u52a9\u7684\u52a9\u624b\u3002<|im_end|>\n<|im_start|>user\n\u4f60\u597d<|im_end|>\n<|im_start|>assistant\n"})}),"\n",(0,s.jsx)(t.h4,{id:"mistral--mixtral-\u7cfb\u5217",children:"Mistral / Mixtral \u7cfb\u5217"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"<s>[INST] \u4f60\u662f\u4e00\u4e2a\u6709\u5e2e\u52a9\u7684\u52a9\u624b\u3002\n\n\u4eca\u5929\u5929\u6c14\u600e\u4e48\u6837\uff1f [/INST] \u4eca\u5929\u5929\u6c14\u6674\u6717\u3002</s>\n"})}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u6807\u8bb0"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u4f5c\u7528"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<s>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u5e8f\u5217\u5f00\u59cb (BOS)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"</s>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u5e8f\u5217\u7ed3\u675f (EOS)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"[INST]"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u6307\u4ee4\u5f00\u59cb"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"[/INST]"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u6307\u4ee4\u7ed3\u675f"})]})]})]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"\u7279\u6b8a\u6807\u8bb0\u6c47\u603b\u8868",children:"\u7279\u6b8a\u6807\u8bb0\u6c47\u603b\u8868"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u6a21\u578b\u7cfb\u5217"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"BOS"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"EOS"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u6d88\u606f\u5f00\u59cb"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u6d88\u606f\u7ed3\u675f"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"\u8f6e\u6b21\u7ed3\u675f"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Qwen/Yi"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"-"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|endoftext|>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|im_start|>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|im_end|>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|im_end|>"})})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"LLaMA 3"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|begin_of_text|>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|end_of_text|>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|start_header_id|>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|end_header_id|>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<|eot_id|>"})})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"LLaMA 2"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<s>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"</s>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"[INST]"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"[/INST]"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"</s>"})})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Mistral"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"<s>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"</s>"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"[INST]"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"[/INST]"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"</s>"})})]})]})]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"sft-\u8bad\u7ec3\u4e2d\u7684-loss-mask",children:"SFT \u8bad\u7ec3\u4e2d\u7684 Loss Mask"}),"\n",(0,s.jsxs)(t.p,{children:["\u7ed3\u5408 ",(0,s.jsx)(t.strong,{children:"Loss Masking"}),"\uff0c\u8bad\u7ec3\u65f6\u53ea\u5bf9 assistant \u7684\u56de\u590d\u8ba1\u7b97\u635f\u5931\uff1a"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"[Token]           [Mask]\n<|im_start|>        0\nsystem              0\n\\n                  0\n\u4f60\u662fAI\u52a9\u624b...        0\n<|im_end|>          0\n\\n                  0\n<|im_start|>        0\nuser                0\n\\n                  0\nSFT\u662f\u4ec0\u4e48...         0\n<|im_end|>          0     <-- Prompt \u7ed3\u675f\n\\n                  0\n<|im_start|>        0\nassistant           0     <-- \u6807\u7b7e\u4e5f\u662f 0\n\\n                  0\nSFT                 1     <-- \u5f00\u59cb\u7b97\u5206\uff01\n\u662f                  1\nSupervised          1\n...                 1\n\u5fae\u8c03                1\n\u3002                  1\n<|im_end|>          1     <-- \u5fc5\u987b\u5b66\u4f1a\u9884\u6d4b\u7ed3\u675f\u7b26\n"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"\u5173\u952e\u70b9\uff1a"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"Mask = 0"}),"\uff1a\u4e0d\u8ba1\u7b97\u635f\u5931\uff08Prompt \u90e8\u5206\uff09"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"Mask = 1"}),"\uff1a\u8ba1\u7b97\u635f\u5931\uff08\u6a21\u578b\u9700\u8981\u5b66\u4e60\u751f\u6210\u7684\u90e8\u5206\uff09"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"<|im_end|>"})," \u4e5f\u9700\u8981\u5b66\u4e60\uff0c\u5426\u5219\u6a21\u578b\u4e0d\u77e5\u9053\u4f55\u65f6\u505c\u6b62"]}),"\n"]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"\u4ee3\u7801\u793a\u4f8b",children:"\u4ee3\u7801\u793a\u4f8b"}),"\n",(0,s.jsx)(t.h3,{id:"\u4f7f\u7528-huggingface-tokenizer",children:"\u4f7f\u7528 HuggingFace Tokenizer"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'from transformers import AutoTokenizer\n\ntokenizer = AutoTokenizer.from_pretrained("Qwen/Qwen2-7B-Instruct")\n\nmessages = [\n    {"role": "system", "content": "\u4f60\u662f\u4e00\u4e2a\u4e13\u4e1a\u7684AI\u52a9\u624b\u3002"},\n    {"role": "user", "content": "SFT\u662f\u4ec0\u4e48\u610f\u601d\uff1f"},\n    {"role": "assistant", "content": "SFT\u662f\u6709\u76d1\u7763\u5fae\u8c03\u3002"}\n]\n\n# \u81ea\u52a8\u8f6c\u6362\u6210 ChatML \u683c\u5f0f\ntext = tokenizer.apply_chat_template(\n    messages,\n    tokenize=False,\n    add_generation_prompt=False\n)\n\nprint(text)\n'})}),"\n",(0,s.jsx)(t.h3,{id:"\u8f93\u51fa\u793a\u4f8b",children:"\u8f93\u51fa\u793a\u4f8b"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"<|im_start|>system\n\u4f60\u662f\u4e00\u4e2a\u4e13\u4e1a\u7684AI\u52a9\u624b\u3002<|im_end|>\n<|im_start|>user\nSFT\u662f\u4ec0\u4e48\u610f\u601d\uff1f<|im_end|>\n<|im_start|>assistant\nSFT\u662f\u6709\u76d1\u7763\u5fae\u8c03\u3002<|im_end|>\n"})}),"\n",(0,s.jsx)(t.h3,{id:"\u751f\u6210\u65f6\u6dfb\u52a0-prompt",children:"\u751f\u6210\u65f6\u6dfb\u52a0 Prompt"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'# \u63a8\u7406\u65f6\uff1a\u53ea\u6709 system + user\uff0c\u8ba9\u6a21\u578b\u751f\u6210 assistant\nmessages = [\n    {"role": "system", "content": "\u4f60\u662f\u4e00\u4e2a\u4e13\u4e1a\u7684AI\u52a9\u624b\u3002"},\n    {"role": "user", "content": "\u4ec0\u4e48\u662f\u5f3a\u5316\u5b66\u4e60\uff1f"}\n]\n\ntext = tokenizer.apply_chat_template(\n    messages,\n    tokenize=False,\n    add_generation_prompt=True  # \u81ea\u52a8\u6dfb\u52a0 <|im_start|>assistant\\n\n)\n'})}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"\u4e3a\u4ec0\u4e48\u9700\u8981\u7279\u6b8a\u6807\u8bb0",children:"\u4e3a\u4ec0\u4e48\u9700\u8981\u7279\u6b8a\u6807\u8bb0\uff1f"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"\u533a\u5206\u89d2\u8272"}),"\uff1a\u8ba9\u6a21\u578b\u77e5\u9053\u8c01\u5728\u8bf4\u8bdd"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"\u63a7\u5236\u751f\u6210"}),"\uff1aEOS \u6807\u8bb0\u544a\u8bc9\u6a21\u578b\u4f55\u65f6\u505c\u6b62"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"\u591a\u8f6e\u5bf9\u8bdd"}),"\uff1a\u6e05\u6670\u5206\u9694\u6bcf\u4e00\u8f6e\u5bf9\u8bdd"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"\u8bad\u7ec3\u6548\u7387"}),"\uff1a\u7cbe\u786e\u63a7\u5236\u54ea\u4e9b token \u53c2\u4e0e\u635f\u5931\u8ba1\u7b97"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"\u6807\u51c6\u5316"}),"\uff1a\u4e0d\u540c\u5de5\u5177\u548c\u6846\u67b6\u53ef\u4ee5\u7edf\u4e00\u5904\u7406"]}),"\n"]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"\u53c2\u8003\u8d44\u6599",children:"\u53c2\u8003\u8d44\u6599"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://github.com/openai/openai-python/blob/main/chatml.md",children:"OpenAI ChatML \u89c4\u8303"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://huggingface.co/docs/transformers/chat_templating",children:"HuggingFace Chat Templates"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://arxiv.org/abs/2407.10671",children:"Qwen2 Technical Report"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://github.com/meta-llama/llama3",children:"LLaMA 3 Model Card"})}),"\n"]})]})}function j(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},28453(e,t,l){l.d(t,{R:()=>d,x:()=>r});var n=l(96540);const s={},i=n.createContext(s);function d(e){const t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);