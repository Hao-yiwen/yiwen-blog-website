---
sidebar_position: 3
title: 字符串设计哲学
tags: [go, string, utf-8, utf-16]
---

# Go vs Java：字符串设计哲学

这是一个非常深刻的问题，直击了 Go 语言设计的灵魂。

简单来说，Java 的设计是基于 **1990 年代的"美好幻想"**，而 Go 的设计是基于 **2000 年之后的"残酷现实"**。

这背后主要有三个原因：**历史包袱、网络传输效率、以及 Go 创始人本身的偏好**。

## 1. 历史原因：Java 押错了宝

要理解这个差异，得看这两门语言诞生的时间点：

### Java (1995年)

当时 Unicode 刚刚起步。大家天真地以为：*"全世界的字符加起来肯定不会超过 65,535 个吧？"*

所以 Java 选择了 **UTF-16**（即 2 个字节表示一个 `char`）。在当时看来，这是一个完美的"定长"设计：一个 `char` = 一个字，下标访问 `str[i]` 既快又准。

### 现实打了脸

后来 Unicode 扩容了，加入了很多生僻字、Emoji（表情包）。65,535 个位置不够用了！

结果就是，Java 的 `char` 现在也不一定能代表一个完整字符了（比如一个 😂 在 Java 里需要两个 `char` 拼起来）。Java 的"定长优势"实际上已经破产了，但为了兼容老代码，无法回头。

### Go (2007年)

这时候，**UTF-8** 已经统领了世界。Go 的设计者之一 **Rob Pike** 正是 **UTF-8 编码的发明者**！

他非常清楚：**"定长字符"是个伪命题**。所以 Go 干脆承认现实：字符串就是一堆变长的字节流，不要试图把它包装成虚假的"定长对象"。

## 2. 只有"字节"才是互联网的通用语

Go 是一门**云原生、偏系统级**的语言，它的核心场景是：网络传输、Web 服务器、微服务。

在这些场景下，**字节（Byte）** 才是王道：

- **网络协议**（HTTP, TCP）传输的是字节。
- **文件系统**（Linux, Windows）存储的是字节。
- **加密算法** 处理的是字节。

### Java 的做法 (UTF-16)

当你从网络读到一个 HTTP 请求（通常是 UTF-8 字节流）时，Java 必须把它**转换**成 UTF-16 的 `String` 对象（内存膨胀，消耗 CPU）。当你又要把它存入数据库或写文件时，又要**转换**回 UTF-8 字节。

**这叫"无谓的编解码消耗"。**

### Go 的做法 (UTF-8 Bytes)

Go 的 `string` 底层就是 UTF-8 字节。

- 从网络读进来？直接扔进 `string`，**不需要转换**。
- 写到文件去？直接把 `string` 的内存拷贝过去，**不需要转换**。

**这就是 Go 高并发、高性能的秘诀之一：零拷贝（Zero Copy）思维。**

## 3. 内存效率：为"代码"省空间

虽然汉字在 UTF-8（Go）中占 3 字节，在 UTF-16（Java）中占 2 字节，看起来 Java 赢了。

但是，现代计算机系统里 **90% 的内容还是 ASCII 字符**（英文、数字、HTML 标签、JSON 括号、代码本身）。

| 内容 | Java (UTF-16) | Go (UTF-8) | 结果 |
| --- | --- | --- | --- |
| 字母 "a" | 2 字节 (0x00, 0x61) | 1 字节 (0x61) | **Go 省一半内存** |
| 数字 "1" | 2 字节 | 1 字节 | **Go 省一半内存** |
| 汉字 "中" | 2 字节 | 3 字节 | Java 略胜 |
| 表情 "😂" | 4 字节 (代理对) | 4 字节 | 打平 |

对于服务器来说，内存就是钱。既然大部分网络协议（如 JSON, XML, Header）都是英文，Go 的设计能节省大量的内存带宽。

## 总结：两种不同的哲学

- **Java (学院派)**：试图构建一个完美的、抽象的"字符世界"，让程序员看不到底层的脏细节。结果为了维持这个抽象，付出了性能和内存的代价。
- **Go (工程派)**：不仅让你看到底层，还告诉你"底层就是乱糟糟的字节"。它不试图掩盖复杂性，而是提供高效的工具（`utf8` 包）让你去处理它。

所以，Go 的 `string` 其实就是 **"只读的字节切片（Read-only Slice of Bytes）"**。

这也引出了 Go 语言中**最最最重要**的概念——**Slice（切片）**。可以说，不懂 Slice 就不懂 Go。
