# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 项目概述

这是一个基于 Docusaurus 构建的技术博客网站（yiwen-blog-website），专注于软件开发和人工智能领域。博客主要使用中文，内容涵盖多个技术领域，通过不同的侧边栏组织。

## 内容组织

网站使用 `sidebars.js` 中定义的多侧边栏架构：

- **aiSidebar** (人工智能): 机器学习、PyTorch、Hugging Face
- **nativeSidebar** (Native开发): iOS (Swift/SwiftUI/UIKit)、Android、React Native、Flutter、HarmonyOS
- **webSidebar** (Web开发): React、Next.js、CSS、JavaScript
- **backendSidebar** (服务端开发): Java、MySQL、Redis、MongoDB
- **csSidebar** (计算机基础): 算法、设计模式、网络
- **whelkSidebar** (抗痘): 个人健康内容

所有侧边栏都使用 `type: 'autogenerated'`，这意味着 `docs/` 目录结构会直接决定导航结构。

## 常用开发命令

### 开发
```bash
npm install          # 安装依赖
npm start           # 启动开发服务器 (localhost:3000)
npm run serve       # 本地预览生产构建
```

### 构建和部署
```bash
npm run build       # 构建生产站点
npm run deploy      # 部署到 GitHub Pages
npm run clear       # 清除 Docusaurus 缓存
```

### 代码质量
```bash
npm run typecheck   # 运行 TypeScript 类型检查
npm run lint:css    # 使用 stylelint 检查 CSS 文件
npx lint-staged     # 运行 pre-commit 检查（Prettier + CSS lint）
```

### Docusaurus 工具
```bash
npm run swizzle                 # 自定义 Docusaurus 组件
npm run write-translations      # 提取 i18n 翻译
npm run write-heading-ids       # 为 markdown 添加标题 ID
```

## 架构说明

### 配置
- **docusaurus.config.js**: 主配置文件，使用异步函数支持 ESM 导入（remark-math, rehype-katex）
- **Base URL**: `/yiwen-blog-website/` (GitHub Pages 子目录)
- **i18n**: 支持 `zh`（默认）和 `en` 语言
- **数学公式渲染**: 通过 remark-math 和 rehype-katex 插件使用 KaTeX
- **搜索**: 使用 `@easyops-cn/docusaurus-search-local` 支持中文搜索

### 自定义组件
- **评论系统**: 在 `src/components/Comment.tsx` 中集成 Giscus，基于 GitHub Discussions
- **Swizzled 主题组件**:
  - `src/theme/DocItem/Layout/index.tsx`: 为文档页面添加评论区
  - `src/theme/BlogPostPage/index.tsx`: 为博客文章添加评论区
  - 博客文章的元数据组件

### 内容结构
- `docs/`: 按领域组织（ai, native, web, backend, cs_base, whelk）
- `blog/`: 博客文章，带阅读时间和"编辑此页"链接
- `static/`: 静态资源（图片、图标）
- 所有 markdown 文件支持 MDX 格式

## Git 工作流

### Pre-commit Hooks
Husky 配置：
- `lint-staged`: 自动格式化 JS/JSON/MD/TS 文件（Prettier）并检查 CSS
- `commitlint`: 强制使用 conventional commit 格式

### CI/CD
`.github/workflows/` 中的 GitHub Actions 工作流：
- **docker-build-and-push.yml**: 在推送版本标签（`v*`）时构建并推送 Docker 镜像到阿里云容器镜像服务
- 需要的 secrets: `ALIYUN_CONTAINER_REGISTRY_USERNAME`, `ALIYUN_CONTAINER_REGISTRY_PASSWORD`, `ALIYUN_CONTAINER_REGISTRY_NAMESPACE`

### 分支策略
- 主分支: `master`
- 开发时创建功能分支（当前: `hyw/202510`）
- GitHub Pages 部署配置在 package.json 的 homepage: `https://hao-yiwen.github.io/yiwen-blog-website/`

## 语法高亮

在 `docusaurus.config.js` 中配置了 Prism 支持多种语言：
```javascript
additionalLanguages: ['swift', 'java', 'bash', 'dart', 'go', 'sql',
                      'objectivec', 'cpp', 'ruby', 'kotlin']
```

## 重要提示

- 添加新文档时，将其放在 `docs/` 下的相应目录中，会自动生成侧边栏条目
- 数学表达式需要 remark-math 和 rehype-katex（已配置）
- 配置文件使用异步函数模式 - 添加插件时保持这个模式
- 全局禁用了侧边栏折叠（`sidebarCollapsed: false`）
- 中文内容是主要内容 - 添加翻译时保持 i18n 结构
- Docker 构建目标平台为 linux/amd64
